<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  <meta name="description"
    content="FAARZ ‚Äî Hyderabad's surplus food redistribution platform connecting restaurants, NGOs, and volunteers to eliminate food waste." />
  <meta name="theme-color" content="#060709" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <link rel="icon"
    href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='80'>üçΩÔ∏è</text></svg>" />
  <title>FAARZ ‚Äî Surplus Food Redistribution</title>
  <link
    href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Mono:wght@400;500&family=Plus+Jakarta+Sans:wght@300;400;500;600;700&display=swap"
    rel="stylesheet" />
  <style>
    *,
    *::before,
    *::after {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      -webkit-tap-highlight-color: transparent
    }

    :root {
      --void: #060709;
      --base: #0d1117;
      --surface: #131920;
      --panel: #1a2330;
      --border: rgba(255, 255, 255, 0.07);
      --lime: #b8f928;
      --amber: #ff9f0a;
      --hot: #ff3b5c;
      --cyan: #06d6a0;
      --blue: #4a9eff;
      --white: #f0f4f8;
      --muted: rgba(200, 215, 230, 0.45);
      --font-h: 'Syne', sans-serif;
      --font-m: 'DM Mono', monospace;
      --font-b: 'Plus Jakarta Sans', sans-serif;
      --r: 20px;
      --r-sm: 12px;
    }

    html,
    body {
      width: 100%;
      height: 100%;
      overflow: hidden;
      font-family: var(--font-b);
      background: var(--void);
      color: var(--white);
      -webkit-font-smoothing: antialiased;
      -moz-osx-font-smoothing: grayscale
    }

    #bg-canvas {
      position: fixed;
      inset: 0;
      z-index: 0;
      pointer-events: none
    }

    /* Noise texture overlay for depth */
    #app::before {
      content: '';
      position: fixed;
      inset: 0;
      z-index: 0;
      opacity: .015;
      pointer-events: none;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='.85' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23n)'/%3E%3C/svg%3E")
    }

    #app {
      position: fixed;
      inset: 0;
      z-index: 1;
      display: flex;
      align-items: center;
      justify-content: center
    }

    #phone {
      width: min(420px, 100vw);
      height: min(860px, 100vh);
      background: var(--base);
      border-radius: clamp(0px, 2vw, 40px);
      overflow: hidden;
      position: relative;
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.06), 0 60px 120px rgba(0, 0, 0, 0.8), 0 0 80px rgba(184, 249, 40, 0.06)
    }

    .screen {
      position: absolute;
      inset: 0;
      overflow-y: auto;
      overflow-x: hidden;
      display: none;
      flex-direction: column;
      background: var(--base);
      scrollbar-width: none;
      -ms-overflow-style: none
    }

    .screen::-webkit-scrollbar {
      display: none
    }

    .screen.active {
      display: flex;
      animation: screenIn 0.38s cubic-bezier(0.4, 0, 0.2, 1) both
    }

    .screen.slide-back {
      animation: screenBack 0.32s cubic-bezier(0.4, 0, 0.2, 1) both
    }

    @keyframes screenIn {
      from {
        opacity: 0;
        transform: translateX(36px) scale(0.97)
      }

      to {
        opacity: 1;
        transform: translateX(0) scale(1)
      }
    }

    @keyframes screenBack {
      from {
        opacity: 0;
        transform: translateX(-28px)
      }

      to {
        opacity: 1;
        transform: translateX(0)
      }
    }

    /* SPLASH */
    #screen-splash {
      background: var(--void);
      align-items: center;
      justify-content: center
    }

    .splash-bg {
      position: absolute;
      inset: 0;
      background: radial-gradient(ellipse 80% 60% at 50% 45%, rgba(184, 249, 40, 0.08) 0%, transparent 65%), radial-gradient(ellipse 50% 40% at 20% 80%, rgba(255, 159, 10, 0.06) 0%, transparent 55%)
    }

    .splash-ring {
      position: absolute;
      border-radius: 50%;
      border: 1px solid rgba(184, 249, 40, 0.07);
      animation: spin linear infinite
    }

    .splash-ring:nth-child(2) {
      width: 350px;
      height: 350px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation-duration: 20s
    }

    .splash-ring:nth-child(3) {
      width: 500px;
      height: 500px;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      animation-duration: 35s;
      animation-direction: reverse;
      border-color: rgba(255, 159, 10, 0.05)
    }

    @keyframes spin {
      to {
        transform: translate(-50%, -50%) rotate(360deg)
      }
    }

    .splash-logo-wrap {
      position: relative;
      z-index: 1;
      text-align: center
    }

    .splash-wordmark {
      font-family: var(--font-h);
      font-size: 72px;
      font-weight: 800;
      letter-spacing: -0.04em;
      line-height: 1;
      background: linear-gradient(135deg, var(--lime) 0%, #e8ff6a 40%, var(--amber) 100%);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
      filter: drop-shadow(0 0 60px rgba(184, 249, 40, 0.35));
      animation: logoIn 1.2s cubic-bezier(0.2, 0, 0, 1) 0.2s both
    }

    .splash-sub {
      font-size: .75rem;
      letter-spacing: .2em;
      text-transform: uppercase;
      color: rgba(184, 249, 40, 0.5);
      font-family: var(--font-m);
      margin-top: 8px;
      animation: logoIn .8s .5s both
    }

    .splash-loader {
      position: absolute;
      bottom: 80px;
      left: 50%;
      transform: translateX(-50%);
      width: 120px;
      height: 2px;
      background: rgba(255, 255, 255, 0.06);
      border-radius: 1px;
      overflow: hidden
    }

    .splash-loader::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(to right, var(--lime), var(--amber));
      animation: loadBar 2.2s cubic-bezier(0.4, 0, 0.2, 1) 0.5s forwards;
      transform: scaleX(0);
      transform-origin: left
    }

    @keyframes loadBar {
      to {
        transform: scaleX(1)
      }
    }

    @keyframes logoIn {
      from {
        opacity: 0;
        transform: translateY(20px) scale(0.95)
      }

      to {
        opacity: 1;
        transform: translateY(0) scale(1)
      }
    }

    /* ROLE SELECT */
    .role-hero {
      padding: 60px 28px 32px;
      background: linear-gradient(180deg, rgba(184, 249, 40, 0.05) 0%, transparent 100%);
      border-bottom: 1px solid var(--border)
    }

    .role-hero-label {
      font-family: var(--font-m);
      font-size: .65rem;
      color: var(--lime);
      letter-spacing: .18em;
      text-transform: uppercase;
      margin-bottom: 12px
    }

    .role-hero-title {
      font-family: var(--font-h);
      font-size: 2.2rem;
      font-weight: 800;
      line-height: 1.1;
      letter-spacing: -.02em
    }

    .role-hero-title span {
      color: var(--lime)
    }

    .role-cards {
      padding: 28px 20px;
      display: flex;
      flex-direction: column;
      gap: 14px
    }

    .role-card {
      border-radius: var(--r);
      border: 1px solid var(--border);
      padding: 22px;
      cursor: pointer;
      position: relative;
      overflow: hidden;
      transition: all .3s cubic-bezier(0.2, 0, 0, 1);
      background: var(--surface)
    }

    .role-card::before {
      content: '';
      position: absolute;
      inset: 0;
      opacity: 0;
      transition: opacity .3s
    }

    .role-card:nth-child(1)::before {
      background: radial-gradient(circle at 80% 50%, rgba(184, 249, 40, .12), transparent 60%)
    }

    .role-card:nth-child(2)::before {
      background: radial-gradient(circle at 80% 50%, rgba(255, 159, 10, .12), transparent 60%)
    }

    .role-card:nth-child(3)::before {
      background: radial-gradient(circle at 80% 50%, rgba(6, 214, 160, .12), transparent 60%)
    }

    .role-card:hover::before,
    .role-card:active::before {
      opacity: 1
    }

    .role-card:hover {
      transform: translateY(-3px) scale(1.01);
      box-shadow: 0 16px 40px rgba(0, 0, 0, 0.4)
    }

    .role-card:nth-child(1):hover {
      border-color: rgba(184, 249, 40, .35)
    }

    .role-card:nth-child(2):hover {
      border-color: rgba(255, 159, 10, .35)
    }

    .role-card:nth-child(3):hover {
      border-color: rgba(6, 214, 160, .35)
    }

    .role-row {
      display: flex;
      align-items: center;
      gap: 16px
    }

    .role-icon-wrap {
      width: 52px;
      height: 52px;
      border-radius: 16px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
      flex-shrink: 0
    }

    .role-icon-lime {
      background: rgba(184, 249, 40, .12);
      border: 1px solid rgba(184, 249, 40, .2)
    }

    .role-icon-amber {
      background: rgba(255, 159, 10, .12);
      border: 1px solid rgba(255, 159, 10, .2)
    }

    .role-icon-cyan {
      background: rgba(6, 214, 160, .12);
      border: 1px solid rgba(6, 214, 160, .2)
    }

    .role-name {
      font-family: var(--font-h);
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: 3px
    }

    .role-desc {
      font-size: .78rem;
      color: var(--muted);
      line-height: 1.4
    }

    .role-arrow {
      margin-left: auto;
      font-size: 1.1rem;
      opacity: .4;
      transition: opacity .2s, transform .2s
    }

    .role-card:hover .role-arrow {
      opacity: 1;
      transform: translateX(4px)
    }

    /* APP HEADER */
    .app-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 18px 20px 14px;
      flex-shrink: 0;
      background: var(--base);
      border-bottom: 1px solid var(--border);
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(20px)
    }

    .back-btn {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      background: var(--surface);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      font-size: 1rem;
      color: var(--white);
      transition: all .2s;
      flex-shrink: 0
    }

    .back-btn:hover {
      background: var(--panel);
      border-color: rgba(255, 255, 255, .15)
    }

    .header-title {
      font-family: var(--font-h);
      font-weight: 700;
      font-size: 1rem
    }

    .header-badge {
      margin-left: auto;
      padding: 4px 10px;
      border-radius: 6px;
      font-family: var(--font-m);
      font-size: .62rem;
      letter-spacing: .05em;
      background: rgba(184, 249, 40, .1);
      color: var(--lime);
      border: 1px solid rgba(184, 249, 40, .2)
    }

    /* CHIPS */
    .chip {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      padding: 4px 10px;
      border-radius: 6px;
      font-family: var(--font-m);
      font-size: .62rem;
      letter-spacing: .05em
    }

    .chip-lime {
      background: rgba(184, 249, 40, .1);
      color: var(--lime);
      border: 1px solid rgba(184, 249, 40, .2)
    }

    .chip-amber {
      background: rgba(255, 159, 10, .1);
      color: var(--amber);
      border: 1px solid rgba(255, 159, 10, .2)
    }

    .chip-hot {
      background: rgba(255, 59, 92, .1);
      color: var(--hot);
      border: 1px solid rgba(255, 59, 92, .2)
    }

    .chip-cyan {
      background: rgba(6, 214, 160, .1);
      color: var(--cyan);
      border: 1px solid rgba(6, 214, 160, .2)
    }

    .chip-blue {
      background: rgba(74, 158, 255, .1);
      color: var(--blue);
      border: 1px solid rgba(74, 158, 255, .2)
    }

    /* BUTTONS */
    .btn {
      width: 100%;
      padding: 16px;
      border-radius: 14px;
      font-family: var(--font-h);
      font-weight: 700;
      font-size: .95rem;
      cursor: pointer;
      border: none;
      transition: all .25s;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 8px
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--lime), #d4f540);
      color: #0a0d06;
      box-shadow: 0 8px 30px rgba(184, 249, 40, .3)
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 12px 40px rgba(184, 249, 40, .4)
    }

    .btn-primary:active {
      transform: translateY(0)
    }

    .btn-secondary {
      background: var(--surface);
      color: var(--white);
      border: 1px solid var(--border)
    }

    .btn-secondary:hover {
      background: var(--panel);
      border-color: rgba(255, 255, 255, .15)
    }

    .btn-amber {
      background: linear-gradient(135deg, var(--amber), #ffb340);
      color: #0a0806;
      box-shadow: 0 8px 30px rgba(255, 159, 10, .3)
    }

    .btn-danger {
      background: rgba(255, 59, 92, .15);
      color: var(--hot);
      border: 1px solid rgba(255, 59, 92, .25)
    }

    .btn-sm {
      padding: 10px 16px;
      border-radius: 10px;
      font-size: .82rem;
      width: auto
    }

    .btn-icon {
      width: 44px;
      height: 44px;
      padding: 0;
      border-radius: 12px;
      font-size: 1.1rem;
      flex-shrink: 0
    }

    /* INPUTS */
    .input-wrap {
      margin-bottom: 16px
    }

    .input-label {
      font-size: .75rem;
      color: var(--muted);
      font-family: var(--font-m);
      margin-bottom: 6px;
      letter-spacing: .05em;
      display: block
    }

    .input-field {
      width: 100%;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 13px 16px;
      color: var(--white);
      font-family: var(--font-b);
      font-size: .9rem;
      transition: border-color .2s;
      outline: none;
      -webkit-appearance: none;
      appearance: none
    }

    .input-field:focus {
      border-color: rgba(184, 249, 40, .4)
    }

    .input-field::placeholder {
      color: rgba(200, 215, 230, .25)
    }

    select.input-field {
      cursor: pointer
    }

    option {
      background: #1a2330
    }

    /* RESTAURANT DASHBOARD */
    .rest-hero {
      padding: 24px 20px 20px;
      background: linear-gradient(180deg, rgba(184, 249, 40, .05) 0%, transparent 100%)
    }

    .rest-greeting {
      font-size: .8rem;
      color: var(--muted);
      margin-bottom: 4px
    }

    .rest-name {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 1.5rem;
      letter-spacing: -.02em
    }

    .rest-name span {
      color: var(--lime)
    }

    .impact-row {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 18px 20px
    }

    .impact-tile {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 12px;
      text-align: center;
      position: relative;
      overflow: hidden;
      transition: all .25s
    }

    .impact-tile:hover {
      border-color: rgba(184, 249, 40, .2);
      transform: translateY(-2px)
    }

    .impact-tile::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(to right, var(--lime), var(--amber))
    }

    .impact-val {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 1.5rem;
      line-height: 1
    }

    .impact-val.lime {
      color: var(--lime)
    }

    .impact-val.amber {
      color: var(--amber)
    }

    .impact-val.cyan {
      color: var(--cyan)
    }

    .impact-unit {
      font-size: .62rem;
      color: var(--muted);
      font-family: var(--font-m);
      margin-top: 4px
    }

    .donate-cta {
      margin: 4px 20px 20px;
      padding: 20px;
      border-radius: 20px;
      background: linear-gradient(135deg, rgba(184, 249, 40, .08), rgba(255, 159, 10, .05));
      border: 1px solid rgba(184, 249, 40, .2);
      cursor: pointer;
      transition: all .3s;
      position: relative;
      overflow: hidden
    }

    .donate-cta::before {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg, rgba(184, 249, 40, .15), rgba(255, 159, 10, .08));
      opacity: 0;
      transition: opacity .3s
    }

    .donate-cta:hover::before {
      opacity: 1
    }

    .donate-cta:hover {
      transform: scale(1.01);
      border-color: rgba(184, 249, 40, .4)
    }

    .donate-cta-label {
      font-family: var(--font-m);
      font-size: .65rem;
      color: var(--lime);
      letter-spacing: .15em;
      text-transform: uppercase;
      margin-bottom: 6px
    }

    .donate-cta-title {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 1.3rem;
      margin-bottom: 4px
    }

    .donate-cta-sub {
      font-size: .8rem;
      color: var(--muted)
    }

    .donate-cta-icon {
      position: absolute;
      right: 20px;
      top: 50%;
      transform: translateY(-50%);
      font-size: 2.5rem;
      filter: drop-shadow(0 0 20px rgba(184, 249, 40, .4));
      animation: floatIcon 3s ease-in-out infinite
    }

    @keyframes floatIcon {

      0%,
      100% {
        transform: translateY(-50%) translateY(0)
      }

      50% {
        transform: translateY(-50%) translateY(-6px)
      }
    }

    .section-head {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin: 0 20px 12px
    }

    .section-label {
      font-family: var(--font-m);
      font-size: .62rem;
      color: var(--muted);
      letter-spacing: .12em;
      text-transform: uppercase
    }

    .section-see-all {
      font-family: var(--font-m);
      font-size: .65rem;
      color: var(--lime);
      cursor: pointer;
      padding: 4px 8px;
      border-radius: 6px;
      transition: background .2s
    }

    .section-see-all:hover {
      background: rgba(184, 249, 40, .08)
    }

    .donation-list {
      padding: 0 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px
    }

    .donation-item {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px 16px;
      display: flex;
      gap: 14px;
      align-items: center;
      transition: all .2s;
      cursor: pointer
    }

    .donation-item:hover {
      border-color: rgba(184, 249, 40, .2);
      transform: translateX(2px)
    }

    .d-icon {
      width: 44px;
      height: 44px;
      border-radius: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0
    }

    .d-info {
      flex: 1;
      min-width: 0
    }

    .d-name {
      font-weight: 600;
      font-size: .9rem;
      margin-bottom: 3px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis
    }

    .d-meta {
      font-size: .72rem;
      color: var(--muted)
    }

    .d-status {
      flex-shrink: 0;
      text-align: right
    }

    .status-dot {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      display: inline-block;
      margin-right: 4px;
      vertical-align: middle
    }

    .status-live {
      background: var(--lime);
      box-shadow: 0 0 8px var(--lime);
      animation: pulseDot 2s infinite
    }

    .status-picked {
      background: var(--amber);
      box-shadow: 0 0 8px var(--amber)
    }

    .status-done {
      background: var(--cyan)
    }

    .status-pending {
      background: var(--muted)
    }

    @keyframes pulseDot {

      0%,
      100% {
        opacity: 1
      }

      50% {
        opacity: .4
      }
    }

    .status-text {
      font-family: var(--font-m);
      font-size: .6rem
    }

    /* DONATE FORM */
    .donate-form-body {
      padding: 20px;
      flex: 1
    }

    .form-step-indicator {
      display: flex;
      gap: 6px;
      margin-bottom: 24px
    }

    .step-dot {
      height: 4px;
      border-radius: 2px;
      flex: 1;
      background: var(--surface);
      transition: background .3s
    }

    .step-dot.active {
      background: var(--lime)
    }

    .step-dot.done {
      background: rgba(184, 249, 40, .35)
    }

    .form-title {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 1.3rem;
      margin-bottom: 4px;
      letter-spacing: -.01em
    }

    .form-sub {
      font-size: .8rem;
      color: var(--muted);
      margin-bottom: 24px
    }

    .allergen-grid {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 8px;
      margin-bottom: 16px
    }

    .allergen-chip {
      padding: 8px 6px;
      border-radius: 10px;
      text-align: center;
      font-family: var(--font-m);
      font-size: .65rem;
      cursor: pointer;
      border: 1px solid var(--border);
      background: var(--surface);
      transition: all .2s;
      color: var(--muted)
    }

    .allergen-chip.selected {
      border-color: rgba(255, 59, 92, .4);
      background: rgba(255, 59, 92, .1);
      color: var(--hot)
    }

    .photo-upload {
      border: 2px dashed rgba(184, 249, 40, .25);
      border-radius: 14px;
      padding: 28px;
      text-align: center;
      cursor: pointer;
      margin-bottom: 16px;
      transition: all .3s
    }

    .photo-upload:hover {
      border-color: rgba(184, 249, 40, .5);
      background: rgba(184, 249, 40, .03)
    }

    .photo-upload.uploaded {
      border-color: rgba(6, 214, 160, .4);
      background: rgba(6, 214, 160, .04);
      border-style: solid
    }

    .photo-upload-icon {
      font-size: 2rem;
      margin-bottom: 8px
    }

    .photo-upload-text {
      font-size: .8rem;
      color: var(--muted)
    }

    .hygiene-check {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      padding: 14px;
      border-radius: 12px;
      cursor: pointer;
      background: rgba(255, 159, 10, .05);
      border: 1px solid rgba(255, 159, 10, .15);
      margin-bottom: 20px;
      transition: all .2s
    }

    .hygiene-check.checked {
      background: rgba(6, 214, 160, .07);
      border-color: rgba(6, 214, 160, .25)
    }

    .check-box {
      width: 22px;
      height: 22px;
      border-radius: 6px;
      flex-shrink: 0;
      background: var(--surface);
      border: 2px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: .7rem;
      transition: all .2s
    }

    .hygiene-check.checked .check-box {
      background: var(--cyan);
      border-color: var(--cyan);
      color: #0a0d06
    }

    .check-text {
      font-size: .8rem;
      color: var(--muted);
      line-height: 1.5
    }

    .form-error {
      color: var(--hot);
      font-size: .75rem;
      font-family: var(--font-m);
      margin: -8px 0 12px;
      display: none
    }

    .form-error.show {
      display: block
    }

    /* BROADCAST */
    #screen-broadcast {
      align-items: center;
      justify-content: center
    }

    .broadcast-inner {
      padding: 40px 28px;
      text-align: center;
      width: 100%
    }

    .broadcast-anim {
      width: 120px;
      height: 120px;
      margin: 0 auto 28px;
      border-radius: 50%;
      position: relative;
      background: rgba(184, 249, 40, .08);
      border: 2px solid rgba(184, 249, 40, .3);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 3rem
    }

    .broadcast-anim::before,
    .broadcast-anim::after {
      content: '';
      position: absolute;
      border-radius: 50%;
      border: 2px solid rgba(184, 249, 40, .3);
      animation: rippleOut 2s ease-out infinite
    }

    .broadcast-anim::before {
      inset: -16px;
      animation-delay: .5s
    }

    .broadcast-anim::after {
      inset: -32px;
      animation-delay: 1s
    }

    @keyframes rippleOut {
      0% {
        opacity: .8;
        transform: scale(0.9)
      }

      100% {
        opacity: 0;
        transform: scale(1.1)
      }
    }

    .broadcast-title {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 1.8rem;
      margin-bottom: 8px
    }

    .broadcast-sub {
      font-size: .85rem;
      color: var(--muted);
      line-height: 1.6;
      max-width: 280px;
      margin: 0 auto 28px
    }

    .ngo-match-list {
      text-align: left;
      background: var(--surface);
      border-radius: 16px;
      border: 1px solid var(--border);
      overflow: hidden;
      margin-bottom: 24px
    }

    .ngo-match-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      animation: slideIn .4s ease both
    }

    .ngo-match-item:last-child {
      border-bottom: none
    }

    @keyframes slideIn {
      from {
        opacity: 0;
        transform: translateX(-10px)
      }

      to {
        opacity: 1;
        transform: translateX(0)
      }
    }

    .ngo-avatar {
      width: 38px;
      height: 38px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(6, 214, 160, .12);
      font-size: 18px;
      flex-shrink: 0
    }

    /* ALL DONATIONS SCREEN */
    #screen-all-donations .donation-item {
      cursor: default
    }

    .filter-row {
      display: flex;
      gap: 8px;
      padding: 0 20px 16px;
      overflow-x: auto;
      scrollbar-width: none
    }

    .filter-row::-webkit-scrollbar {
      display: none
    }

    .filter-chip {
      padding: 7px 14px;
      border-radius: 20px;
      border: 1px solid var(--border);
      background: var(--surface);
      font-family: var(--font-m);
      font-size: .65rem;
      cursor: pointer;
      white-space: nowrap;
      transition: all .2s;
      color: var(--muted)
    }

    .filter-chip.active {
      background: rgba(184, 249, 40, .1);
      border-color: rgba(184, 249, 40, .3);
      color: var(--lime)
    }

    /* IMPACT SCREEN */
    #screen-impact {
      background: var(--base)
    }

    .impact-screen-hero {
      padding: 24px 20px 20px;
      background: linear-gradient(180deg, rgba(184, 249, 40, .05) 0%, transparent 100%)
    }

    .big-stat {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 3.5rem;
      letter-spacing: -.04em;
      line-height: 1;
      background: linear-gradient(135deg, var(--lime), var(--amber));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text
    }

    .progress-bar-wrap {
      margin-bottom: 16px
    }

    .prog-label {
      display: flex;
      justify-content: space-between;
      margin-bottom: 6px;
      font-size: .8rem
    }

    .prog-track {
      height: 8px;
      background: var(--surface);
      border-radius: 4px;
      overflow: hidden
    }

    .prog-fill-el {
      height: 100%;
      border-radius: 4px;
      background: linear-gradient(to right, var(--lime), var(--amber));
      transition: width 1.5s cubic-bezier(0.4, 0, 0.2, 1)
    }

    .monthly-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 0 20px 20px
    }

    .monthly-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      transition: all .25s
    }

    .monthly-card:hover {
      border-color: rgba(184, 249, 40, .2);
      transform: translateY(-2px)
    }

    .monthly-card-val {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 1.6rem;
      margin-bottom: 3px
    }

    .monthly-card-label {
      font-size: .72rem;
      color: var(--muted);
      font-family: var(--font-m)
    }

    .chart-bar-row {
      display: flex;
      align-items: flex-end;
      gap: 6px;
      height: 80px;
      padding: 0 20px;
      margin-bottom: 8px
    }

    .chart-bar {
      flex: 1;
      border-radius: 4px 4px 0 0;
      background: rgba(184, 249, 40, .15);
      border: 1px solid rgba(184, 249, 40, .2);
      position: relative;
      transition: background .2s;
      cursor: pointer
    }

    .chart-bar:hover {
      background: rgba(184, 249, 40, .3)
    }

    .chart-bar .bar-fill {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      border-radius: 4px 4px 0 0;
      background: linear-gradient(to top, var(--lime), rgba(184, 249, 40, .5));
      transition: height 1s cubic-bezier(0.4, 0, 0.2, 1)
    }

    .chart-labels {
      display: flex;
      gap: 6px;
      padding: 0 20px;
      margin-bottom: 20px
    }

    .chart-label {
      flex: 1;
      text-align: center;
      font-family: var(--font-m);
      font-size: .55rem;
      color: var(--muted)
    }

    /* NGO DASHBOARD */
    .ngo-hero {
      padding: 24px 20px 20px;
      background: linear-gradient(180deg, rgba(6, 214, 160, .05) 0%, transparent 100%)
    }

    .ngo-stats {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin: 0 20px 20px
    }

    .ngo-stat {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 14px
    }

    .ngo-stat-val {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 1.4rem;
      color: var(--cyan)
    }

    .ngo-stat-label {
      font-size: .72rem;
      color: var(--muted);
      margin-top: 3px
    }

    .map-container {
      margin: 0 20px 20px;
      height: 220px;
      border-radius: 18px;
      overflow: hidden;
      border: 1px solid var(--border);
      position: relative;
      background: var(--surface)
    }

    .map-canvas-el {
      width: 100%;
      height: 100%
    }

    .map-overlay-label {
      position: absolute;
      top: 12px;
      left: 12px;
      padding: 5px 10px;
      border-radius: 8px;
      background: rgba(13, 17, 23, .85);
      backdrop-filter: blur(10px);
      font-family: var(--font-m);
      font-size: .62rem;
      color: var(--lime);
      border: 1px solid rgba(184, 249, 40, .2);
      letter-spacing: .05em
    }

    .map-legend {
      position: absolute;
      bottom: 12px;
      left: 12px;
      display: flex;
      gap: 8px
    }

    .legend-dot {
      display: flex;
      align-items: center;
      gap: 4px;
      font-family: var(--font-m);
      font-size: .58rem;
      color: var(--muted)
    }

    .legend-dot span {
      width: 7px;
      height: 7px;
      border-radius: 50%;
      display: inline-block
    }

    .donations-feed {
      padding: 0 20px;
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin-bottom: 20px
    }

    .feed-item {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      cursor: pointer;
      transition: all .25s
    }

    .feed-item:hover {
      border-color: rgba(6, 214, 160, .35);
      transform: translateY(-2px);
      box-shadow: 0 12px 30px rgba(0, 0, 0, .3)
    }

    .feed-top {
      display: flex;
      align-items: flex-start;
      justify-content: space-between;
      margin-bottom: 12px
    }

    .feed-rest {
      font-weight: 700;
      font-size: .95rem;
      margin-bottom: 2px
    }

    .feed-time {
      font-family: var(--font-m);
      font-size: .62rem;
      color: var(--muted)
    }

    .feed-bar {
      height: 2px;
      background: var(--border);
      border-radius: 1px;
      margin: 12px 0 0;
      overflow: hidden
    }

    .feed-fill {
      height: 100%;
      border-radius: 1px;
      background: linear-gradient(to right, var(--cyan), var(--lime))
    }

    /* NGO DETAIL */
    .food-preview {
      width: 100%;
      height: 180px;
      border-radius: 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 4rem;
      margin-bottom: 16px;
      position: relative;
      overflow: hidden
    }

    .food-preview::after {
      content: '';
      position: absolute;
      inset: 0;
      background: linear-gradient(to top, rgba(13, 17, 23, .8) 0%, transparent 50%)
    }

    .food-preview-label {
      position: absolute;
      bottom: 14px;
      left: 16px;
      font-family: var(--font-h);
      font-weight: 700;
      font-size: 1.1rem;
      z-index: 1
    }

    .detail-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 10px;
      margin-bottom: 16px
    }

    .detail-tile {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px
    }

    .detail-tile-label {
      font-size: .68rem;
      color: var(--muted);
      font-family: var(--font-m);
      margin-bottom: 6px
    }

    .detail-tile-val {
      font-family: var(--font-h);
      font-weight: 700;
      font-size: 1rem
    }

    .timer-countdown {
      background: rgba(255, 59, 92, .07);
      border: 1px solid rgba(255, 59, 92, .2);
      border-radius: 12px;
      padding: 12px 16px;
      display: flex;
      align-items: center;
      gap: 10px;
      margin-bottom: 16px
    }

    .timer-val {
      font-family: var(--font-m);
      font-weight: 500;
      color: var(--hot);
      font-size: .88rem
    }

    /* VOLUNTEER */
    .vol-hero {
      padding: 24px 20px 20px;
      background: linear-gradient(180deg, rgba(74, 158, 255, .05) 0%, transparent 100%)
    }

    .vol-stats {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 10px;
      margin: 0 20px 20px
    }

    .vol-stat {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 14px;
      padding: 12px;
      text-align: center
    }

    .vol-stat-val {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 1.3rem;
      color: var(--blue)
    }

    .vol-stat-label {
      font-size: .62rem;
      color: var(--muted);
      font-family: var(--font-m);
      margin-top: 3px
    }

    .task-notification {
      margin: 0 20px 16px;
      background: rgba(184, 249, 40, .06);
      border: 1px solid rgba(184, 249, 40, .3);
      border-radius: 18px;
      padding: 18px;
      cursor: pointer;
      transition: all .3s;
      position: relative;
      overflow: hidden
    }

    .task-notification::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 2px;
      background: linear-gradient(to right, var(--lime), var(--amber))
    }

    .task-notification:hover {
      border-color: rgba(184, 249, 40, .5);
      transform: scale(1.01)
    }

    .task-notif-top {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      margin-bottom: 12px
    }

    .task-notif-badge {
      padding: 3px 10px;
      border-radius: 20px;
      font-family: var(--font-m);
      font-size: .6rem;
      background: rgba(184, 249, 40, .15);
      color: var(--lime);
      animation: glowPulse 1.5s infinite
    }

    @keyframes glowPulse {

      0%,
      100% {
        box-shadow: 0 0 0 rgba(184, 249, 40, 0)
      }

      50% {
        box-shadow: 0 0 16px rgba(184, 249, 40, .3)
      }
    }

    .task-rest-name {
      font-family: var(--font-h);
      font-weight: 700;
      font-size: 1.1rem;
      margin-bottom: 4px
    }

    .task-address {
      font-size: .78rem;
      color: var(--muted)
    }

    .task-meta {
      display: flex;
      gap: 8px;
      margin-top: 12px;
      flex-wrap: wrap
    }

    .leaderboard-section {
      padding: 0 20px 20px
    }

    .lb-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px 16px;
      border-radius: 12px;
      background: var(--surface);
      border: 1px solid var(--border);
      margin-bottom: 8px;
      transition: all .2s
    }

    .lb-item:hover {
      border-color: rgba(255, 255, 255, .12);
      transform: translateX(2px)
    }

    .lb-item.me {
      border-color: rgba(184, 249, 40, .3);
      background: rgba(184, 249, 40, .05)
    }

    .lb-rank {
      font-family: var(--font-m);
      font-size: .8rem;
      color: var(--muted);
      width: 24px;
      text-align: center;
      flex-shrink: 0
    }

    .lb-avatar {
      width: 36px;
      height: 36px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: var(--panel);
      font-size: 18px;
      flex-shrink: 0
    }

    .lb-name {
      font-weight: 600;
      font-size: .88rem
    }

    .lb-xp {
      font-family: var(--font-m);
      font-size: .68rem;
      color: var(--muted)
    }

    .lb-pts {
      margin-left: auto;
      font-family: var(--font-h);
      font-weight: 700;
      font-size: .9rem;
      color: var(--lime)
    }

    /* TRACKING */
    .tracking-map {
      height: 260px;
      position: relative;
      background: var(--surface);
      flex-shrink: 0
    }

    .tracking-canvas {
      width: 100%;
      height: 100%
    }

    .tracking-info {
      padding: 20px;
      flex: 1;
      overflow-y: auto;
      scrollbar-width: none
    }

    .tracking-info::-webkit-scrollbar {
      display: none
    }

    .tracking-eta {
      display: flex;
      align-items: center;
      gap: 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px
    }

    .eta-time {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 2rem;
      color: var(--lime);
      line-height: 1
    }

    .eta-label {
      font-size: .75rem;
      color: var(--muted);
      margin-top: 2px
    }

    .eta-divider {
      width: 1px;
      height: 36px;
      background: var(--border)
    }

    .eta-address {
      font-size: .82rem;
      color: var(--white);
      line-height: 1.5
    }

    .progress-track {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: 16px;
      padding: 16px;
      margin-bottom: 16px
    }

    .progress-title {
      font-family: var(--font-h);
      font-weight: 700;
      font-size: .95rem;
      margin-bottom: 14px
    }

    .progress-step {
      display: flex;
      gap: 12px;
      align-items: flex-start;
      padding-bottom: 14px;
      position: relative
    }

    .progress-step:not(:last-child)::before {
      content: '';
      position: absolute;
      left: 15px;
      top: 30px;
      bottom: 0;
      width: 1px;
      background: var(--border)
    }

    .progress-step.done:not(:last-child)::before {
      background: rgba(184, 249, 40, .3)
    }

    .p-icon {
      width: 30px;
      height: 30px;
      border-radius: 8px;
      flex-shrink: 0;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: .85rem;
      background: var(--panel);
      border: 1px solid var(--border);
      transition: all .3s
    }

    .progress-step.done .p-icon {
      background: rgba(184, 249, 40, .12);
      border-color: rgba(184, 249, 40, .3)
    }

    .progress-step.active .p-icon {
      background: rgba(255, 159, 10, .12);
      border-color: rgba(255, 159, 10, .4);
      animation: glowPulse 1.5s infinite
    }

    .p-label {
      font-weight: 600;
      font-size: .85rem;
      margin-bottom: 2px
    }

    .p-sub {
      font-size: .72rem;
      color: var(--muted)
    }

    /* SUCCESS */
    #screen-success {
      align-items: center;
      justify-content: center
    }

    .success-inner {
      padding: 40px 28px;
      text-align: center;
      max-width: 100%
    }

    .success-icon-wrap {
      width: 100px;
      height: 100px;
      border-radius: 50%;
      margin: 0 auto 24px;
      background: rgba(184, 249, 40, .1);
      border: 2px solid rgba(184, 249, 40, .4);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 2.8rem;
      animation: successBounce .6s cubic-bezier(0.2, 0, 0, 1.5) both
    }

    @keyframes successBounce {
      from {
        opacity: 0;
        transform: scale(0.5)
      }

      to {
        opacity: 1;
        transform: scale(1)
      }
    }

    .success-title {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 1.9rem;
      letter-spacing: -.02em;
      margin-bottom: 8px
    }

    .success-sub {
      font-size: .85rem;
      color: var(--muted);
      line-height: 1.6;
      margin-bottom: 28px
    }

    .impact-reveal {
      background: var(--surface);
      border: 1px solid rgba(184, 249, 40, .2);
      border-radius: 16px;
      padding: 20px;
      margin-bottom: 24px;
      display: grid;
      grid-template-columns: repeat(3, 1fr)
    }

    .impact-reveal-col {
      padding: 12px;
      text-align: center;
      border-right: 1px solid var(--border)
    }

    .impact-reveal-col:last-child {
      border-right: none
    }

    .ir-val {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 1.4rem;
      color: var(--lime)
    }

    .ir-label {
      font-size: .65rem;
      color: var(--muted);
      font-family: var(--font-m);
      margin-top: 3px
    }

    .confetti-container {
      position: absolute;
      inset: 0;
      pointer-events: none;
      overflow: hidden
    }

    /* BOTTOM NAV */
    .bottom-nav {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      height: 72px;
      background: rgba(13, 17, 23, .97);
      backdrop-filter: blur(20px);
      border-top: 1px solid var(--border);
      display: flex;
      align-items: center;
      justify-content: space-around;
      padding: 0 8px 8px;
      z-index: 20;
      flex-shrink: 0
    }

    .nav-item {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
      flex: 1;
      padding: 8px 4px;
      cursor: pointer;
      opacity: .4;
      transition: all .2s;
      position: relative;
      border-radius: 10px
    }

    .nav-item:hover {
      opacity: .7;
      background: rgba(255, 255, 255, .04)
    }

    .nav-item.active {
      opacity: 1
    }

    .nav-item.active::before {
      content: '';
      position: absolute;
      top: 0;
      left: 50%;
      transform: translateX(-50%);
      width: 24px;
      height: 2px;
      border-radius: 1px;
      background: var(--lime)
    }

    .nav-icon {
      font-size: 1.2rem
    }

    .nav-label {
      font-family: var(--font-m);
      font-size: .55rem;
      letter-spacing: .05em;
      color: var(--muted)
    }

    .nav-item.active .nav-label {
      color: var(--lime)
    }

    /* SCROLLABLE */
    .scrollable {
      flex: 1;
      overflow-y: auto;
      overflow-x: hidden;
      padding-bottom: 80px;
      scrollbar-width: none
    }

    .scrollable::-webkit-scrollbar {
      display: none
    }

    /* LOADING DOTS */
    .loading-dots {
      display: flex;
      gap: 6px;
      align-items: center;
      justify-content: center
    }

    .loading-dots span {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--lime);
      animation: dotBounce 1.2s ease-in-out infinite
    }

    .loading-dots span:nth-child(2) {
      animation-delay: .2s
    }

    .loading-dots span:nth-child(3) {
      animation-delay: .4s
    }

    @keyframes dotBounce {

      0%,
      100% {
        transform: translateY(0);
        opacity: .5
      }

      50% {
        transform: translateY(-6px);
        opacity: 1
      }
    }

    /* TOAST */
    .toast {
      position: absolute;
      bottom: 90px;
      left: 50%;
      transform: translateX(-50%) translateY(20px);
      background: var(--panel);
      border: 1px solid rgba(184, 249, 40, .3);
      color: var(--white);
      padding: 10px 20px;
      border-radius: 12px;
      font-family: var(--font-m);
      font-size: .72rem;
      white-space: nowrap;
      z-index: 100;
      opacity: 0;
      transition: all .3s;
      pointer-events: none;
      box-shadow: 0 8px 30px rgba(0, 0, 0, .5)
    }

    .toast.show {
      opacity: 1;
      transform: translateX(-50%) translateY(0)
    }

    /* MODAL */
    .modal-overlay {
      position: absolute;
      inset: 0;
      background: rgba(0, 0, 0, .7);
      backdrop-filter: blur(4px);
      z-index: 50;
      display: none;
      align-items: flex-end
    }

    .modal-overlay.open {
      display: flex;
      animation: fadeIn .25s ease
    }

    @keyframes fadeIn {
      from {
        opacity: 0
      }

      to {
        opacity: 1
      }
    }

    .modal-sheet {
      background: var(--base);
      border-radius: 24px 24px 0 0;
      border: 1px solid var(--border);
      border-bottom: none;
      padding: 24px 20px 40px;
      width: 100%;
      animation: slideUp .3s cubic-bezier(0.2, 0, 0, 1)
    }

    @keyframes slideUp {
      from {
        transform: translateY(100%)
      }

      to {
        transform: translateY(0)
      }
    }

    .modal-handle {
      width: 40px;
      height: 4px;
      border-radius: 2px;
      background: var(--border);
      margin: 0 auto 20px
    }

    .modal-title {
      font-family: var(--font-h);
      font-weight: 800;
      font-size: 1.3rem;
      margin-bottom: 16px
    }

    /* EMPTY STATE */
    .empty-state {
      text-align: center;
      padding: 40px 20px;
      color: var(--muted)
    }

    .empty-icon {
      font-size: 3rem;
      margin-bottom: 12px;
      opacity: .5
    }

    .empty-text {
      font-size: .85rem;
      line-height: 1.6
    }

    /* LEAFLET MAP OVERRIDES */
    .leaflet-container {
      background: #111820 !important;
      font-family: var(--font-b) !important
    }

    .leaflet-tile {
      filter: brightness(0.82) saturate(1.3) hue-rotate(158deg) contrast(1.05) !important
    }

    .leaflet-tile-pane {
      opacity: 1 !important
    }

    .leaflet-control-zoom,
    .leaflet-control-attribution {
      display: none !important
    }

    .leaflet-popup-content-wrapper {
      background: rgba(10, 16, 26, 0.97) !important;
      border: 1px solid rgba(184, 249, 40, 0.35) !important;
      border-radius: 14px !important;
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.7), 0 0 24px rgba(184, 249, 40, 0.1) !important;
      backdrop-filter: blur(20px) !important
    }

    .leaflet-popup-tip-container .leaflet-popup-tip {
      background: rgba(10, 16, 26, 0.97) !important
    }

    .leaflet-popup-content {
      margin: 12px 16px !important;
      color: #f0f4f8 !important;
      min-width: 190px
    }

    .leaflet-popup-close-button {
      color: rgba(200, 215, 230, 0.45) !important;
      font-size: 16px !important;
      top: 8px !important;
      right: 10px !important
    }

    .leaflet-popup-close-button:hover {
      color: var(--lime) !important
    }

    .pop-name {
      font-family: 'Syne', sans-serif;
      font-weight: 700;
      font-size: 13px;
      color: #b8f928;
      margin-bottom: 3px
    }

    .pop-type {
      font-size: 10px;
      color: rgba(200, 215, 230, 0.45);
      font-family: 'DM Mono', monospace;
      letter-spacing: .06em;
      text-transform: uppercase;
      margin-bottom: 6px
    }

    .pop-dist {
      font-size: 11px;
      color: #ff9f0a;
      font-family: 'DM Mono', monospace
    }

    .pop-accept {
      display: block;
      margin-top: 8px;
      padding: 6px 12px;
      background: rgba(184, 249, 40, 0.12);
      border: 1px solid rgba(184, 249, 40, 0.3);
      border-radius: 8px;
      color: #b8f928;
      font-family: 'DM Mono', monospace;
      font-size: 10px;
      letter-spacing: .05em;
      cursor: pointer;
      text-align: center;
      transition: background .2s
    }

    .pop-accept:hover {
      background: rgba(184, 249, 40, 0.25)
    }

    .map-loading {
      position: absolute;
      inset: 0;
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      background: var(--surface);
      z-index: 500;
      border-radius: 18px;
      gap: 8px;
      pointer-events: none
    }

    .map-loading-text {
      font-family: var(--font-m);
      font-size: .68rem;
      color: var(--muted);
      letter-spacing: .1em
    }

    #live-map,
    #full-map {
      width: 100%;
      height: 100%;
      border-radius: 18px
    }

    /* NAV ACTIVE STATES per role */
    .nav-item.nav-cyan.active::before {
      background: var(--cyan)
    }

    .nav-item.nav-cyan.active .nav-label {
      color: var(--cyan)
    }

    .nav-item.nav-blue.active::before {
      background: var(--blue)
    }

    .nav-item.nav-blue.active .nav-label {
      color: var(--blue)
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ENHANCED EFFECTS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */

    /* Glassmorphism cards */
    .glass {
      background: rgba(19, 25, 32, .65) !important;
      backdrop-filter: blur(16px) saturate(180%);
      -webkit-backdrop-filter: blur(16px) saturate(180%);
      border: 1px solid rgba(255, 255, 255, .08) !important
    }

    /* Shimmer animation for loading states */
    @keyframes shimmer {
      0% {
        background-position: -200% 0
      }

      100% {
        background-position: 200% 0
      }
    }

    .shimmer {
      background: linear-gradient(90deg, var(--surface) 25%, rgba(184, 249, 40, .04) 50%, var(--surface) 75%);
      background-size: 200% 100%;
      animation: shimmer 2s infinite
    }

    /* Glow effects */
    @keyframes glowLime {

      0%,
      100% {
        box-shadow: 0 0 8px rgba(184, 249, 40, .15)
      }

      50% {
        box-shadow: 0 0 24px rgba(184, 249, 40, .35)
      }
    }

    @keyframes glowCyan {

      0%,
      100% {
        box-shadow: 0 0 8px rgba(6, 214, 160, .15)
      }

      50% {
        box-shadow: 0 0 24px rgba(6, 214, 160, .35)
      }
    }

    /* Enhanced card hover with subtle glow */
    .role-card {
      backdrop-filter: blur(8px)
    }

    .role-card:active {
      transform: scale(0.98) !important;
      transition: transform .1s
    }

    /* Smooth number transitions */
    .counter-animate {
      transition: transform .3s cubic-bezier(0.2, 0, 0, 1)
    }

    /* Haptic-like button feedback */
    .btn:active {
      transform: scale(0.96) !important;
      transition: transform .08s
    }

    .btn-primary:active {
      box-shadow: 0 4px 15px rgba(184, 249, 40, .2) !important
    }

    /* Pulsing live indicator */
    @keyframes livePulse {
      0% {
        opacity: 1;
        box-shadow: 0 0 0 0 rgba(184, 249, 40, .5)
      }

      70% {
        opacity: 1;
        box-shadow: 0 0 0 6px rgba(184, 249, 40, 0)
      }

      100% {
        opacity: 1;
        box-shadow: 0 0 0 0 rgba(184, 249, 40, 0)
      }
    }

    .live-indicator {
      animation: livePulse 2s infinite
    }

    /* Enhanced scrollbar for non-hidden areas */
    .scrollable {
      scroll-behavior: smooth;
      -webkit-overflow-scrolling: touch
    }

    /* Donation item stagger animation */
    @keyframes listItemIn {
      from {
        opacity: 0;
        transform: translateY(12px)
      }

      to {
        opacity: 1;
        transform: translateY(0)
      }
    }

    .donation-item,
    .feed-item,
    .lb-item {
      animation: listItemIn .35s cubic-bezier(0.4, 0, 0.2, 1) both
    }

    .donation-item:nth-child(1),
    .feed-item:nth-child(1),
    .lb-item:nth-child(1) {
      animation-delay: 0s
    }

    .donation-item:nth-child(2),
    .feed-item:nth-child(2),
    .lb-item:nth-child(2) {
      animation-delay: .06s
    }

    .donation-item:nth-child(3),
    .feed-item:nth-child(3),
    .lb-item:nth-child(3) {
      animation-delay: .12s
    }

    .donation-item:nth-child(4),
    .feed-item:nth-child(4),
    .lb-item:nth-child(4) {
      animation-delay: .18s
    }

    /* Float animation for various elements */
    @keyframes floatGentle {

      0%,
      100% {
        transform: translateY(0)
      }

      50% {
        transform: translateY(-4px)
      }
    }

    /* Enhanced input focus ring */
    .input-field:focus {
      border-color: rgba(184, 249, 40, .5);
      box-shadow: 0 0 0 3px rgba(184, 249, 40, .08)
    }

    /* Better touch targets */
    @media(hover:none) {
      .role-card:active::before {
        opacity: 1
      }

      .btn:active {
        transform: scale(0.96) !important
      }
    }

    /* Phone frame glow enhancement */
    #phone {
      box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.06), 0 60px 120px rgba(0, 0, 0, 0.8), 0 0 80px rgba(184, 249, 40, 0.06), inset 0 0 0 0.5px rgba(255, 255, 255, 0.04)
    }

    /* Selection color */
    ::selection {
      background: rgba(184, 249, 40, .2);
      color: var(--white)
    }

    /* Heartbeat for the ‚ô• */
    @keyframes heartbeat {

      0%,
      100% {
        transform: scale(1)
      }

      14% {
        transform: scale(1.3)
      }

      28% {
        transform: scale(1)
      }

      42% {
        transform: scale(1.2)
      }

      56% {
        transform: scale(1)
      }
    }

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
       LIGHT MODE
       ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    [data-theme="light"] {
      --void: #f0f2f5;
      --base: #ffffff;
      --surface: #f5f7fa;
      --panel: #e8ecf1;
      --border: rgba(0, 0, 0, 0.08);
      --lime: #65a30d;
      --amber: #d97706;
      --hot: #dc2626;
      --cyan: #059669;
      --blue: #2563eb;
      --white: #111827;
      --muted: rgba(55, 65, 80, 0.55);
    }

    /* Phone frame in light mode */
    [data-theme="light"] #phone {
      box-shadow: 0 0 0 1px rgba(0, 0, 0, 0.06), 0 40px 80px rgba(0, 0, 0, 0.12), 0 0 60px rgba(101, 163, 13, 0.08), inset 0 0 0 0.5px rgba(0, 0, 0, 0.04);
    }

    /* Bottom nav in light mode */
    [data-theme="light"] .bottom-nav {
      background: rgba(255, 255, 255, 0.95);
      border-top-color: rgba(0, 0, 0, 0.06);
    }

    /* App header glassmorphism in light mode  */
    [data-theme="light"] .app-header {
      background: rgba(255, 255, 255, 0.85);
      border-bottom-color: rgba(0, 0, 0, 0.06);
    }

    /* Splash screen in light mode */
    [data-theme="light"] #screen-splash {
      background: linear-gradient(180deg, #f8faf5 0%, #f0f2f5 100%);
    }

    [data-theme="light"] .splash-bg {
      background: radial-gradient(ellipse 80% 60% at 50% 45%, rgba(101, 163, 13, 0.08) 0%, transparent 65%), radial-gradient(ellipse 50% 40% at 20% 80%, rgba(217, 119, 6, 0.06) 0%, transparent 55%);
    }

    [data-theme="light"] .splash-ring {
      border-color: rgba(101, 163, 13, 0.12);
    }

    [data-theme="light"] .splash-ring:nth-child(3) {
      border-color: rgba(217, 119, 6, 0.1);
    }

    [data-theme="light"] .splash-wordmark {
      background: linear-gradient(135deg, #4d7c0f 0%, #65a30d 40%, #d97706 100%);
      -webkit-background-clip: text;
      background-clip: text;
      filter: drop-shadow(0 0 40px rgba(101, 163, 13, 0.2));
    }

    [data-theme="light"] .splash-sub {
      color: rgba(101, 163, 13, 0.7);
    }

    [data-theme="light"] .splash-loader {
      background: rgba(0, 0, 0, 0.06);
    }

    [data-theme="light"] .splash-loader::after {
      background: linear-gradient(to right, var(--lime), var(--amber));
    }

    /* Leaflet tiles: remove dark filter in light mode */
    [data-theme="light"] .leaflet-tile {
      filter: none !important;
    }

    [data-theme="light"] .leaflet-container {
      background: #e8ecf1 !important;
    }

    [data-theme="light"] .leaflet-popup-content-wrapper {
      background: rgba(255, 255, 255, 0.97) !important;
      border-color: rgba(101, 163, 13, 0.3) !important;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1), 0 0 16px rgba(101, 163, 13, 0.06) !important;
    }

    [data-theme="light"] .leaflet-popup-tip-container .leaflet-popup-tip {
      background: rgba(255, 255, 255, 0.97) !important;
    }

    [data-theme="light"] .leaflet-popup-content {
      color: #111827 !important;
    }

    [data-theme="light"] .pop-name {
      color: #4d7c0f;
    }

    [data-theme="light"] .pop-dist {
      color: #d97706;
    }

    [data-theme="light"] .pop-accept {
      background: rgba(101, 163, 13, 0.1);
      border-color: rgba(101, 163, 13, 0.25);
      color: #4d7c0f;
    }

    [data-theme="light"] .pop-accept:hover {
      background: rgba(101, 163, 13, 0.2);
    }

    /* Chip colors for light mode ‚Äî deeper borders */
    [data-theme="light"] .chip-lime {
      background: rgba(101, 163, 13, 0.08);
      border-color: rgba(101, 163, 13, 0.2);
    }

    [data-theme="light"] .chip-amber {
      background: rgba(217, 119, 6, 0.08);
      border-color: rgba(217, 119, 6, 0.2);
    }

    [data-theme="light"] .chip-hot {
      background: rgba(220, 38, 38, 0.08);
      border-color: rgba(220, 38, 38, 0.2);
    }

    [data-theme="light"] .chip-cyan {
      background: rgba(5, 150, 105, 0.08);
      border-color: rgba(5, 150, 105, 0.2);
    }

    [data-theme="light"] .chip-blue {
      background: rgba(37, 99, 235, 0.08);
      border-color: rgba(37, 99, 235, 0.2);
    }

    /* Button primary in light mode */
    [data-theme="light"] .btn-primary {
      background: linear-gradient(135deg, #65a30d, #84cc16);
      color: #fff;
      box-shadow: 0 6px 20px rgba(101, 163, 13, 0.25);
    }

    [data-theme="light"] .btn-primary:hover {
      box-shadow: 0 10px 30px rgba(101, 163, 13, 0.35);
    }

    [data-theme="light"] .btn-amber {
      background: linear-gradient(135deg, #d97706, #f59e0b);
      color: #fff;
    }

    [data-theme="light"] .btn-secondary {
      background: var(--surface);
      color: var(--white);
      border-color: var(--border);
    }

    [data-theme="light"] .btn-danger {
      background: rgba(220, 38, 38, 0.08);
      color: var(--hot);
      border-color: rgba(220, 38, 38, 0.2);
    }

    /* Impact tiles glow line */
    [data-theme="light"] .impact-tile::before {
      background: linear-gradient(to right, var(--lime), var(--amber));
      opacity: 0.6;
    }

    /* Toast in light mode */
    [data-theme="light"] .toast {
      background: #fff;
      border-color: rgba(101, 163, 13, 0.25);
      color: #111827;
      box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
    }

    /* Modal in light mode */
    [data-theme="light"] .modal-overlay {
      background: rgba(0, 0, 0, 0.25);
    }

    [data-theme="light"] .modal-sheet {
      background: #fff;
      border-color: rgba(0, 0, 0, 0.08);
    }

    [data-theme="light"] .modal-handle {
      background: rgba(0, 0, 0, 0.12);
    }

    /* Select options in light mode */
    [data-theme="light"] option {
      background: #fff;
    }

    /* Status dots glow reduced in light mode */
    [data-theme="light"] .status-live {
      box-shadow: 0 0 6px rgba(101, 163, 13, 0.5);
    }

    [data-theme="light"] .status-picked {
      box-shadow: 0 0 6px rgba(217, 119, 6, 0.5);
    }

    /* Big stat gradient for light mode */
    [data-theme="light"] .big-stat {
      background: linear-gradient(135deg, #4d7c0f, #d97706);
      -webkit-background-clip: text;
      background-clip: text;
    }

    /* Input focus in light mode */
    [data-theme="light"] .input-field:focus {
      border-color: rgba(101, 163, 13, 0.5);
      box-shadow: 0 0 0 3px rgba(101, 163, 13, 0.08);
    }

    /* Nav item active indicator */
    [data-theme="light"] .nav-item.active::before {
      background: var(--lime);
    }

    /* Body / BG canvas light mode */
    [data-theme="light"] body {
      background: var(--void);
    }

    /* Noise overlay lighter */
    [data-theme="light"] #app::before {
      opacity: 0.008;
    }

    /* Selection color */
    [data-theme="light"] ::selection {
      background: rgba(101, 163, 13, 0.15);
    }

    /* Role card hero gradient */
    [data-theme="light"] .role-hero {
      background: linear-gradient(180deg, rgba(101, 163, 13, 0.04) 0%, transparent 100%);
    }

    [data-theme="light"] .rest-hero {
      background: linear-gradient(180deg, rgba(101, 163, 13, 0.04) 0%, transparent 100%);
    }

    [data-theme="light"] .ngo-hero {
      background: linear-gradient(180deg, rgba(5, 150, 105, 0.04) 0%, transparent 100%);
    }

    [data-theme="light"] .vol-hero {
      background: linear-gradient(180deg, rgba(37, 99, 235, 0.04) 0%, transparent 100%);
    }

    /* Map loading overlay */
    [data-theme="light"] .map-loading {
      background: var(--surface);
    }

    [data-theme="light"] .map-overlay-label {
      background: rgba(255, 255, 255, 0.9);
      border-color: rgba(101, 163, 13, 0.2);
    }

    /* CTA donate card */
    [data-theme="light"] .donate-cta {
      background: linear-gradient(135deg, rgba(101, 163, 13, 0.06), rgba(217, 119, 6, 0.04));
      border-color: rgba(101, 163, 13, 0.2);
    }

    [data-theme="light"] .donate-cta::before {
      background: linear-gradient(135deg, rgba(101, 163, 13, 0.1), rgba(217, 119, 6, 0.06));
    }

    /* Filter chips active */
    [data-theme="light"] .filter-chip.active {
      background: rgba(101, 163, 13, 0.08);
      border-color: rgba(101, 163, 13, 0.25);
    }

    /* Photo upload zone */
    [data-theme="light"] .photo-upload {
      border-color: rgba(101, 163, 13, 0.25);
    }

    [data-theme="light"] .photo-upload:hover {
      border-color: rgba(101, 163, 13, 0.45);
      background: rgba(101, 163, 13, 0.02);
    }

    [data-theme="light"] .photo-upload.uploaded {
      border-color: rgba(5, 150, 105, 0.35);
      background: rgba(5, 150, 105, 0.03);
    }

    /* Hygiene check box */
    [data-theme="light"] .hygiene-check {
      background: rgba(217, 119, 6, 0.04);
      border-color: rgba(217, 119, 6, 0.15);
    }

    [data-theme="light"] .hygiene-check.checked {
      background: rgba(5, 150, 105, 0.05);
      border-color: rgba(5, 150, 105, 0.2);
    }

    /* Broadcast animation */
    [data-theme="light"] .broadcast-anim {
      background: rgba(101, 163, 13, 0.06);
      border-color: rgba(101, 163, 13, 0.3);
    }

    [data-theme="light"] .broadcast-anim::before,
    [data-theme="light"] .broadcast-anim::after {
      border-color: rgba(101, 163, 13, 0.2);
    }

    /* Tracking canvas bg */
    [data-theme="light"] .tracking-map {
      background: var(--surface);
    }

    /* Success screen */
    [data-theme="light"] .success-icon-wrap {
      background: rgba(101, 163, 13, 0.08);
      border-color: rgba(101, 163, 13, 0.3);
    }

    /* Confetti colors handled in JS */

    /* ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê THEME TOGGLE SWITCH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê */
    .theme-toggle {
      position: absolute;
      top: 16px;
      right: 16px;
      z-index: 30;
      display: flex;
      align-items: center;
      gap: 8px;
      cursor: pointer;
      padding: 6px 12px;
      border-radius: 20px;
      background: var(--surface);
      border: 1px solid var(--border);
      transition: all 0.3s;
      font-family: var(--font-m);
      font-size: 0.6rem;
      letter-spacing: 0.05em;
      color: var(--muted);
    }

    .theme-toggle:hover {
      border-color: rgba(184, 249, 40, 0.3);
      background: var(--panel);
    }

    [data-theme="light"] .theme-toggle:hover {
      border-color: rgba(101, 163, 13, 0.3);
    }

    .theme-toggle-track {
      width: 32px;
      height: 18px;
      border-radius: 9px;
      background: var(--panel);
      border: 1px solid var(--border);
      position: relative;
      transition: all 0.3s;
    }

    .theme-toggle-knob {
      width: 14px;
      height: 14px;
      border-radius: 50%;
      background: var(--lime);
      position: absolute;
      top: 1px;
      left: 1px;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      box-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
    }

    [data-theme="light"] .theme-toggle-knob {
      left: 15px;
      background: var(--amber);
    }

    .theme-icon {
      font-size: 0.85rem;
      line-height: 1;
    }
  </style>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.css" />
</head>

<body>
  <canvas id="bg-canvas"></canvas>

  <!-- TOAST -->
  <div class="toast" id="toast"></div>

  <!-- MODAL -->
  <div class="modal-overlay" id="modal-overlay" onclick="closeModal()">
    <div class="modal-sheet" onclick="event.stopPropagation()">
      <div class="modal-handle"></div>
      <div id="modal-content"></div>
    </div>
  </div>

  <div id="app">
    <div id="phone">

      <!-- THEME TOGGLE -->
      <div class="theme-toggle" onclick="toggleTheme()" title="Toggle light/dark mode">
        <span class="theme-icon" id="theme-icon">üåô</span>
        <div class="theme-toggle-track">
          <div class="theme-toggle-knob"></div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SPLASH ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen active" id="screen-splash">
        <div class="splash-bg"></div>
        <div class="splash-ring"></div>
        <div class="splash-ring"></div>
        <div class="splash-logo-wrap">
          <div class="splash-wordmark">FAARZ</div>
          <div class="splash-sub">Surplus Food ¬∑ Real Impact</div>
          <div
            style="margin-top:40px;display:flex;gap:8px;justify-content:center;opacity:0;animation:logoIn .6s 1.4s both">
            <span class="chip chip-lime">Hyderabad Pilot</span>
            <span class="chip chip-amber">Zero Waste</span>
          </div>
        </div>
        <div class="splash-loader"></div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ROLE SELECT ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-role">
        <div class="role-hero">
          <div class="role-hero-label">Welcome to FAARZ</div>
          <div class="role-hero-title">Who are<br>you <span>today?</span></div>
        </div>
        <div class="role-cards">
          <div class="role-card" onclick="enterRole('restaurant')">
            <div class="role-row">
              <div class="role-icon-wrap role-icon-lime">üçΩÔ∏è</div>
              <div>
                <div class="role-name">Restaurant / Donor</div>
                <div class="role-desc">List surplus food for NGOs to collect. Build your impact score.</div>
              </div>
              <div class="role-arrow">‚Ä∫</div>
            </div>
          </div>
          <div class="role-card" onclick="enterRole('ngo')">
            <div class="role-row">
              <div class="role-icon-wrap role-icon-amber">üè†</div>
              <div>
                <div class="role-name">NGO / Shelter</div>
                <div class="role-desc">Browse and accept donations. Track volunteers in real-time.</div>
              </div>
              <div class="role-arrow">‚Ä∫</div>
            </div>
          </div>
          <div class="role-card" onclick="enterRole('volunteer')">
            <div class="role-row">
              <div class="role-icon-wrap role-icon-cyan">üõµ</div>
              <div>
                <div class="role-name">Volunteer / Rider</div>
                <div class="role-desc">Pick up and deliver donations. Earn XP and rank up.</div>
              </div>
              <div class="role-arrow">‚Ä∫</div>
            </div>
          </div>
        </div>
        <div style="padding:0 20px 32px;text-align:center">
          <div style="font-size:.72rem;color:var(--muted)">Hyderabad ¬∑ Madhapur Pilot Zone</div>
          <div style="font-size:.65rem;color:rgba(200,215,230,.2);margin-top:4px;font-family:var(--font-m)">Geotagging ¬∑
            Real-time ¬∑ Verified</div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê RESTAURANT DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-restaurant">
        <div class="scrollable" id="rest-scrollable">
          <div class="rest-hero">
            <div class="rest-greeting" id="rest-greeting">Good morning üëã</div>
            <div class="rest-name">Spice <span>Garden</span></div>
            <div style="display:flex;gap:8px;margin-top:12px;flex-wrap:wrap">
              <span class="chip chip-lime">‚úì Verified Partner</span>
              <span class="chip chip-amber" id="rest-rank-chip">üèÜ Top Donor</span>
            </div>
          </div>

          <div class="impact-row">
            <div class="impact-tile">
              <div class="impact-val lime" id="stat-meals">0</div>
              <div class="impact-unit">MEALS SERVED</div>
            </div>
            <div class="impact-tile">
              <div class="impact-val amber" id="stat-kg">0</div>
              <div class="impact-unit">KG SAVED</div>
            </div>
            <div class="impact-tile">
              <div class="impact-val cyan" id="stat-count">0</div>
              <div class="impact-unit">DONATIONS</div>
            </div>
          </div>

          <div class="donate-cta" onclick="goTo('screen-donate','screenIn')">
            <div class="donate-cta-label">Quick Action</div>
            <div class="donate-cta-title">Donate Surplus<br>Food Now</div>
            <div class="donate-cta-sub" id="ngo-nearby-text">2 NGOs are active nearby</div>
            <div class="donate-cta-icon">üç±</div>
          </div>

          <div class="section-head">
            <div class="section-label">Recent Donations</div>
            <div class="section-see-all" onclick="goTo('screen-all-donations','screenIn')">See all ‚Üí</div>
          </div>
          <div class="donation-list" id="recent-list">
            <!-- Rendered by JS -->
          </div>

          <!-- Impact Banner -->
          <div
            style="margin:0 20px 20px;padding:16px;background:var(--surface);border:1px solid rgba(184,249,40,.15);border-radius:16px">
            <div class="section-label" style="margin-bottom:8px">This Month's Impact</div>
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
              <span style="font-size:.8rem;color:var(--muted)">Food Rescue Score</span>
              <span style="font-family:var(--font-h);font-weight:700;color:var(--lime)" id="frs-score-text">94 /
                100</span>
            </div>
            <div style="height:6px;background:var(--panel);border-radius:3px;overflow:hidden">
              <div
                style="height:100%;width:0%;background:linear-gradient(to right,var(--lime),var(--amber));border-radius:3px;transition:width 1.5s cubic-bezier(0.4,0,0.2,1)"
                id="frs-bar"></div>
            </div>
            <div style="margin-top:10px;font-size:.72rem;color:var(--muted)" id="frs-rank-text">üèÜ Ranked #1 in Madhapur
              HITEC Zone</div>
          </div>
        </div>
        <div class="bottom-nav">
          <div class="nav-item active" onclick="setRestNav('home',this)" id="rnav-home">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">HOME</div>
          </div>
          <div class="nav-item" onclick="goTo('screen-donate','screenIn');setRestNav('donate',this)" id="rnav-donate">
            <div class="nav-icon">‚ûï</div>
            <div class="nav-label">DONATE</div>
          </div>
          <div class="nav-item" onclick="goTo('screen-impact','screenIn');setRestNav('impact',this)" id="rnav-impact">
            <div class="nav-icon">üìä</div>
            <div class="nav-label">IMPACT</div>
          </div>
          <div class="nav-item" onclick="goTo('screen-role','screenBack')" id="rnav-roles">
            <div class="nav-icon">‚Ü©</div>
            <div class="nav-label">ROLES</div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê ALL DONATIONS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-all-donations">
        <div class="app-header">
          <div class="back-btn" onclick="goTo('screen-restaurant','screenBack')">‚Äπ</div>
          <div class="header-title">All Donations</div>
          <div class="header-badge" id="all-count-badge">0 total</div>
        </div>
        <div class="filter-row" id="filter-row">
          <div class="filter-chip active" onclick="filterDonations('all',this)">All</div>
          <div class="filter-chip" onclick="filterDonations('live',this)">üü¢ Live</div>
          <div class="filter-chip" onclick="filterDonations('picked',this)">üü° Picked Up</div>
          <div class="filter-chip" onclick="filterDonations('delivered',this)">‚úÖ Delivered</div>
          <div class="filter-chip" onclick="filterDonations('pending',this)">‚è≥ Pending</div>
        </div>
        <div class="scrollable" id="all-donations-list"
          style="padding:0 20px;padding-bottom:30px;display:flex;flex-direction:column;gap:10px">
          <!-- Rendered by JS -->
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê IMPACT SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-impact">
        <div class="app-header">
          <div class="back-btn" onclick="goTo('screen-restaurant','screenBack')">‚Äπ</div>
          <div class="header-title">My Impact</div>
          <span class="chip chip-lime" style="font-size:.55rem">LIVE</span>
        </div>
        <div class="scrollable" style="padding:0 20px 30px">
          <div style="padding:20px 0 8px">
            <div class="section-label" style="margin-bottom:6px">Total Meals Served</div>
            <div class="big-stat" id="impact-big-meals">247</div>
            <div style="font-size:.78rem;color:var(--muted);margin-top:4px">Since joining FAARZ ¬∑ Madhapur Zone</div>
          </div>

          <!-- FRS -->
          <div
            style="background:var(--surface);border:1px solid rgba(184,249,40,.2);border-radius:16px;padding:16px;margin:16px 0">
            <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
              <div>
                <div class="section-label" style="margin-bottom:4px">Food Rescue Score</div>
                <div style="font-family:var(--font-h);font-weight:800;font-size:1.6rem;color:var(--lime)"
                  id="impact-frs-num">94</div>
              </div>
              <div style="text-align:right">
                <div style="font-size:.72rem;color:var(--muted)">City Rank</div>
                <div style="font-family:var(--font-h);font-weight:800;font-size:1.4rem;color:var(--amber)">#1</div>
              </div>
            </div>
            <div style="height:8px;background:var(--panel);border-radius:4px;overflow:hidden">
              <div
                style="height:100%;width:0%;background:linear-gradient(to right,var(--lime),var(--amber));border-radius:4px;transition:width 1.5s .3s cubic-bezier(0.4,0,0.2,1)"
                id="impact-frs-bar"></div>
            </div>
          </div>

          <div class="monthly-grid">
            <div class="monthly-card">
              <div class="monthly-card-val" style="color:var(--lime)" id="impact-kg-total">83</div>
              <div class="monthly-card-label">KG FOOD RESCUED</div>
            </div>
            <div class="monthly-card">
              <div class="monthly-card-val" style="color:var(--amber)" id="impact-co2">41</div>
              <div class="monthly-card-label">KG CO‚ÇÇ SAVED</div>
            </div>
            <div class="monthly-card">
              <div class="monthly-card-val" style="color:var(--cyan)" id="impact-donations-total">32</div>
              <div class="monthly-card-label">DONATIONS MADE</div>
            </div>
            <div class="monthly-card">
              <div class="monthly-card-val" style="color:var(--blue)" id="impact-ngos-reached">3</div>
              <div class="monthly-card-label">NGOs REACHED</div>
            </div>
          </div>

          <!-- Bar Chart -->
          <div style="margin-bottom:8px">
            <div class="section-label" style="margin:0 0 12px">Weekly Activity (kg)</div>
            <div class="chart-bar-row" id="chart-bars"></div>
            <div class="chart-labels" id="chart-labels"></div>
          </div>

          <div
            style="background:rgba(184,249,40,.05);border:1px solid rgba(184,249,40,.2);border-radius:14px;padding:16px;margin-top:8px">
            <div
              style="font-size:.78rem;color:var(--muted);margin-bottom:8px;font-family:var(--font-m);letter-spacing:.05em;text-transform:uppercase;font-size:.62rem">
              CSR DOWNLOAD</div>
            <div style="font-weight:600;margin-bottom:4px">Impact Report ‚Äî February 2026</div>
            <div style="font-size:.78rem;color:var(--muted);margin-bottom:12px">PDF ¬∑ 47 KB ¬∑ Ready to download</div>
            <button class="btn btn-primary btn-sm" onclick="downloadPDFReport()">üìÑ Download PDF
              Report</button>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê DONATE FORM ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-donate">
        <div class="app-header">
          <div class="back-btn" onclick="goTo('screen-restaurant','screenBack')">‚Äπ</div>
          <div class="header-title">Donate Food</div>
          <div class="header-badge" id="donate-step-badge">Step 1/3</div>
        </div>
        <div class="donate-form-body scrollable" style="padding-bottom:100px">
          <div class="form-step-indicator">
            <div class="step-dot active" id="step1"></div>
            <div class="step-dot" id="step2"></div>
            <div class="step-dot" id="step3"></div>
          </div>
          <div class="form-title">Food Details</div>
          <div class="form-sub">Tell us what you're donating so NGOs can prepare.</div>

          <div class="input-wrap">
            <label class="input-label">FOOD TYPE <span style="color:var(--hot)">*</span></label>
            <select class="input-field" id="f-type">
              <option value="">Select food category</option>
              <option value="Biryani">üçõ Cooked Rice / Biryani</option>
              <option value="Curry">üç≤ Curries & Gravies</option>
              <option value="Breads">üçû Breads & Rotis</option>
              <option value="Salad">ü•ó Salads & Raw Veggies</option>
              <option value="Desserts">üçÆ Desserts & Sweets</option>
              <option value="Beverages">ü•§ Beverages</option>
              <option value="Packaged">üì¶ Packaged / Sealed Food</option>
              <option value="Mixed Meal">üç± Mixed Meal</option>
            </select>
            <div class="form-error" id="err-type">Please select a food type</div>
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div class="input-wrap">
              <label class="input-label">QUANTITY (KG) <span style="color:var(--hot)">*</span></label>
              <input class="input-field" type="number" id="f-qty" placeholder="e.g. 5" min="0.5" step="0.5" />
              <div class="form-error" id="err-qty">Enter a quantity</div>
            </div>
            <div class="input-wrap">
              <label class="input-label">PORTIONS</label>
              <input class="input-field" type="number" id="f-portions" placeholder="e.g. 20" />
            </div>
          </div>

          <div class="input-wrap">
            <label class="input-label">TIME PREPARED</label>
            <input class="input-field" type="time" id="f-prepared" value="14:00" />
          </div>

          <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px">
            <div class="input-wrap">
              <label class="input-label">PICKUP FROM</label>
              <input class="input-field" type="time" id="f-from" value="15:00" />
            </div>
            <div class="input-wrap">
              <label class="input-label">PICKUP UNTIL</label>
              <input class="input-field" type="time" id="f-until" value="17:00" />
            </div>
          </div>

          <div class="input-wrap">
            <div class="input-label">ALLERGEN TAGS</div>
            <div class="allergen-grid" id="allergens">
              <div class="allergen-chip" onclick="toggleAllergen(this)" data-tag="Nuts">ü•ú Nuts</div>
              <div class="allergen-chip" onclick="toggleAllergen(this)" data-tag="Dairy">ü•õ Dairy</div>
              <div class="allergen-chip" onclick="toggleAllergen(this)" data-tag="Gluten">üåæ Gluten</div>
              <div class="allergen-chip" onclick="toggleAllergen(this)" data-tag="Fish">üêü Fish</div>
              <div class="allergen-chip" onclick="toggleAllergen(this)" data-tag="Eggs">ü•ö Eggs</div>
              <div class="allergen-chip" onclick="toggleAllergen(this)" data-tag="Vegan">üå± Vegan</div>
            </div>
          </div>

          <div class="input-wrap">
            <div class="input-label">FOOD PHOTO</div>
            <div class="photo-upload" id="photo-upload-zone"
              onclick="document.getElementById('photo-file-input').click()">
              <input type="file" id="photo-file-input" accept="image/*" capture="environment" style="display:none"
                onchange="handlePhotoUpload(this)">
              <div class="photo-upload-icon" id="photo-icon">üì∑</div>
              <div class="photo-upload-text" id="photo-text">Tap to upload a photo<br><span
                  style="font-size:.68rem;opacity:.6">Required for safety verification</span></div>
              <img id="photo-preview"
                style="display:none;width:100%;max-height:160px;object-fit:cover;border-radius:12px;margin-top:8px">
            </div>
          </div>

          <div class="hygiene-check" id="hygiene-check" onclick="toggleHygiene()">
            <div class="check-box" id="check-box"></div>
            <div class="check-text">I confirm this food has been prepared under hygienic conditions and is safe for
              consumption. I accept FAARZ's liability disclaimer.</div>
          </div>
          <div class="form-error" id="err-hygiene">Please confirm the hygiene declaration</div>

          <!-- GPS Pin -->
          <div
            style="background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:14px;display:flex;gap:12px;align-items:center;margin-bottom:20px">
            <div style="font-size:1.5rem">üìç</div>
            <div style="flex:1">
              <div
                style="font-family:var(--font-m);font-size:.62rem;color:var(--muted);letter-spacing:.05em;text-transform:uppercase;margin-bottom:2px">
                GEO-PIN AUTO-DETECTED</div>
              <div style="font-size:.88rem;font-weight:600">Spice Garden, Madhapur</div>
              <div style="font-size:.72rem;color:var(--muted)">17.4474¬∞ N, 78.3762¬∞ E ¬∑ Accuracy: ¬±5m</div>
            </div>
            <span class="chip chip-lime" style="font-size:.55rem">GPS ‚úì</span>
          </div>

          <button class="btn btn-primary" onclick="submitDonation()">
            üöÄ Broadcast Donation
          </button>
          <div style="margin-top:12px;text-align:center;font-size:.72rem;color:var(--muted)">Your listing will be
            visible to nearby NGOs instantly</div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê BROADCAST ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-broadcast">
        <div class="broadcast-inner">
          <div class="broadcast-anim" id="broadcast-food-icon">üç±</div>
          <div class="broadcast-title">Going Live!</div>
          <div class="broadcast-sub" id="broadcast-desc">Your donation is being broadcast to verified NGOs in Madhapur
            zone.</div>
          <div id="matching-state">
            <div class="loading-dots" style="margin-bottom:12px"><span></span><span></span><span></span></div>
            <div style="font-size:.78rem;color:var(--muted);font-family:var(--font-m)">Matching nearby NGOs...</div>
          </div>
          <div id="matched-state" style="display:none">
            <div class="ngo-match-list">
              <div class="ngo-match-item" style="animation-delay:.1s">
                <div class="ngo-avatar">üè†</div>
                <div>
                  <div style="font-weight:600;font-size:.88rem">Akshaya Patra</div>
                  <div style="font-size:.72rem;color:var(--muted)">üìç 1.2 km ¬∑ Accepted ‚úì</div>
                </div>
                <span class="chip chip-cyan" style="font-size:.55rem">MATCHED</span>
              </div>
              <div class="ngo-match-item" style="animation-delay:.3s">
                <div class="ngo-avatar">üíô</div>
                <div>
                  <div style="font-weight:600;font-size:.88rem">Feeding Hyderabad</div>
                  <div style="font-size:.72rem;color:var(--muted)">üìç 2.7 km ¬∑ Notified</div>
                </div>
                <span class="chip chip-amber" style="font-size:.55rem">PENDING</span>
              </div>
            </div>
            <div
              style="background:rgba(184,249,40,.06);border:1px solid rgba(184,249,40,.2);border-radius:12px;padding:12px 16px;margin-bottom:24px;display:flex;gap:10px;align-items:center">
              <span>üõµ</span>
              <span style="font-size:.8rem;color:var(--muted)">Volunteer <strong style="color:var(--white)">Raza
                  M.</strong> assigned ¬∑ ETA <strong style="color:var(--lime)">18 min</strong></span>
            </div>
            <button class="btn btn-primary" onclick="goTo('screen-tracking','screenIn')">üìç Track Live</button>
            <button class="btn btn-secondary" style="margin-top:10px" onclick="goTo('screen-restaurant','screenBack')">‚Üê
              Back to Dashboard</button>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NGO DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-ngo">
        <div class="scrollable">
          <div class="ngo-hero">
            <div class="rest-greeting" style="color:var(--muted)">Welcome back üåø</div>
            <div class="rest-name" style="color:var(--cyan)">Akshaya <span style="color:var(--white)">Patra</span></div>
            <div style="display:flex;gap:8px;margin-top:12px">
              <span class="chip chip-cyan">‚úì Verified NGO</span>
              <span class="chip chip-amber" id="ngo-new-badge">üîî 3 New</span>
            </div>
          </div>

          <div class="ngo-stats">
            <div class="ngo-stat">
              <div class="ngo-stat-val" id="ngo-meals">1,248</div>
              <div class="ngo-stat-label">Meals this month</div>
            </div>
            <div class="ngo-stat">
              <div class="ngo-stat-val" id="ngo-received">47</div>
              <div class="ngo-stat-label">Donations received</div>
            </div>
          </div>

          <div class="section-head">
            <div class="section-label">Live Donation Map</div>
            <div class="section-see-all" style="color:var(--cyan)"
              onclick="goTo('screen-ngo-map','screenIn');setNgoNav('map',document.getElementById('ngo-nav-map'))">Expand
              ‚Üó</div>
          </div>
          <div class="map-container" style="height:260px">
            <div id="map-loading" class="map-loading">
              <div class="loading-dots"><span></span><span></span><span></span></div>
              <div class="map-loading-text">LOCATING YOU...</div>
            </div>
            <div id="live-map"></div>
            <div class="map-overlay-label" id="map-overlay-label" style="z-index:400">üìç Detecting location...</div>
            <div class="map-legend" style="z-index:400">
              <div class="legend-dot"><span style="background:#b8f928"></span>NGO / Shelter</div>
              <div class="legend-dot"><span style="background:#ff9f0a"></span>Active Pickup</div>
              <div class="legend-dot"><span style="background:#06d6a0"></span>You</div>
            </div>
          </div>

          <div class="section-head">
            <div class="section-label" id="ngo-feed-label">Available Donations</div>
            <div class="section-see-all" style="color:var(--cyan)" onclick="openFilterModal()">Filter
              ‚äô</div>
          </div>
          <div class="donations-feed" id="ngo-feed">
            <div class="feed-item" onclick="goTo('screen-ngo-detail','screenIn')">
              <div class="feed-top">
                <div>
                  <div class="feed-rest">Spice Garden</div>
                  <div class="feed-time">üìç 1.2 km ¬∑ Posted 8 min ago</div>
                </div>
                <span class="chip chip-hot">‚ö° Expires 2h</span>
              </div>
              <div style="display:flex;gap:8px;flex-wrap:wrap"><span class="chip chip-lime">üçõ 8 kg Biryani</span><span
                  class="chip chip-amber">~25 portions</span></div>
              <div class="feed-bar">
                <div class="feed-fill" style="width:75%"></div>
              </div>
            </div>
            <div class="feed-item" onclick="goTo('screen-ngo-detail','screenIn')">
              <div class="feed-top">
                <div>
                  <div class="feed-rest">Barbeque Nation</div>
                  <div class="feed-time">üìç 2.4 km ¬∑ Posted 22 min ago</div>
                </div>
                <span class="chip chip-amber">4h left</span>
              </div>
              <div style="display:flex;gap:8px;flex-wrap:wrap"><span class="chip chip-lime">ü•© 12 kg Mixed
                  Grill</span><span class="chip chip-amber">~40 portions</span></div>
              <div class="feed-bar">
                <div class="feed-fill" style="width:55%"></div>
              </div>
            </div>
            <div class="feed-item" onclick="goTo('screen-ngo-detail','screenIn')">
              <div class="feed-top">
                <div>
                  <div class="feed-rest">Paradise Restaurant</div>
                  <div class="feed-time">üìç 3.1 km ¬∑ Posted 35 min ago</div>
                </div>
                <span class="chip chip-cyan">6h left</span>
              </div>
              <div style="display:flex;gap:8px;flex-wrap:wrap"><span class="chip chip-lime">üçû 6 kg Naan /
                  Rotis</span><span class="chip chip-blue">üåæ Gluten</span></div>
              <div class="feed-bar">
                <div class="feed-fill" style="width:35%"></div>
              </div>
            </div>
          </div>
        </div>
        <div class="bottom-nav" id="ngo-nav">
          <div class="nav-item nav-cyan active" id="ngo-nav-home" onclick="setNgoNav('home',this)">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">HOME</div>
          </div>
          <div class="nav-item nav-cyan" id="ngo-nav-map"
            onclick="setNgoNav('map',this);goTo('screen-ngo-map','screenIn')">
            <div class="nav-icon">üó∫</div>
            <div class="nav-label">MAP</div>
          </div>
          <div class="nav-item nav-cyan" id="ngo-nav-hist"
            onclick="setNgoNav('hist',this);goTo('screen-ngo-history','screenIn')">
            <div class="nav-icon">üìã</div>
            <div class="nav-label">HISTORY</div>
          </div>
          <div class="nav-item nav-cyan" onclick="goTo('screen-role','screenBack')">
            <div class="nav-icon">‚Ü©</div>
            <div class="nav-label">ROLES</div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NGO DETAIL ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-ngo-detail">
        <div class="app-header">
          <div class="back-btn" onclick="goTo('screen-ngo','screenBack')">‚Äπ</div>
          <div class="header-title">Donation Details</div>
          <span class="chip chip-hot" style="font-size:.6rem">‚ö° Expires 2h</span>
        </div>
        <div class="scrollable" style="padding:0 20px 100px">
          <div class="food-preview" style="margin-top:16px">
            üçõ<div class="food-preview-label">Chicken Biryani</div>
          </div>
          <div style="display:flex;gap:10px;flex-wrap:wrap;margin-bottom:16px">
            <span class="chip chip-lime">üü¢ Safe to Consume</span>
            <span class="chip chip-amber">Spice Garden</span>
            <span class="chip chip-cyan">üìç 1.2 km</span>
          </div>
          <div class="detail-grid">
            <div class="detail-tile">
              <div class="detail-tile-label">QUANTITY</div>
              <div class="detail-tile-val">8 kg</div>
            </div>
            <div class="detail-tile">
              <div class="detail-tile-label">PORTIONS</div>
              <div class="detail-tile-val">~25</div>
            </div>
            <div class="detail-tile">
              <div class="detail-tile-label">PREPARED AT</div>
              <div class="detail-tile-val">14:30</div>
            </div>
            <div class="detail-tile">
              <div class="detail-tile-label">PICKUP WINDOW</div>
              <div class="detail-tile-val">15‚Äì17:00</div>
            </div>
          </div>
          <div class="section-label" style="margin-bottom:8px">ALLERGENS</div>
          <div style="display:flex;gap:6px;flex-wrap:wrap;margin-bottom:16px">
            <span class="chip chip-hot">üå∂ Spicy</span>
            <span class="chip chip-blue">ü•õ Dairy-free</span>
            <span class="chip chip-cyan">ü•ú Nut-free</span>
          </div>
          <div class="timer-countdown">
            <div style="font-size:1.2rem">‚è∞</div>
            <div>
              <div style="font-size:.8rem;color:var(--muted)">This donation expires in</div>
              <div class="timer-val" id="detail-timer">1:47:32</div>
            </div>
          </div>
          <div
            style="background:var(--surface);border:1px solid var(--border);border-radius:14px;padding:14px;margin-bottom:16px">
            <div class="section-label" style="margin-bottom:8px">RESTAURANT</div>
            <div style="display:flex;gap:12px;align-items:center">
              <div
                style="width:40px;height:40px;border-radius:10px;background:rgba(184,249,40,.1);display:flex;align-items:center;justify-content:center;font-size:20px">
                üçΩÔ∏è</div>
              <div>
                <div style="font-weight:700;font-size:.92rem">Spice Garden</div>
                <div style="font-size:.72rem;color:var(--muted)">FSSAI Verified ¬∑ Madhapur Main Rd</div>
              </div>
              <span class="chip chip-lime" style="margin-left:auto;font-size:.55rem">94/100</span>
            </div>
          </div>
          <button class="btn btn-primary" onclick="acceptDonation()">‚úÖ Accept & Assign Volunteer</button>
          <button class="btn btn-secondary" style="margin-top:10px" onclick="openChatModal()">üí¨ Chat with
            Donor</button>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VOLUNTEER DASHBOARD ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-volunteer">
        <div class="scrollable">
          <div class="vol-hero">
            <div class="rest-greeting" style="color:var(--muted)">Ready to ride üõµ</div>
            <div class="rest-name" style="color:var(--blue)">Raza <span style="color:var(--white)">Mirza</span></div>
            <div style="display:flex;gap:8px;margin-top:12px">
              <span class="chip chip-blue">üèÖ Level 8 Rider</span>
              <span class="chip chip-lime" id="vol-status-chip">‚ö° Online</span>
            </div>
          </div>

          <div class="vol-stats">
            <div class="vol-stat">
              <div class="vol-stat-val">142</div>
              <div class="vol-stat-label">Deliveries</div>
            </div>
            <div class="vol-stat">
              <div class="vol-stat-val" id="vol-xp">3,840</div>
              <div class="vol-stat-label">XP Points</div>
            </div>
            <div class="vol-stat">
              <div class="vol-stat-val">#3</div>
              <div class="vol-stat-label">City Rank</div>
            </div>
          </div>

          <!-- Task Alert -->
          <div class="task-notification" onclick="goTo('screen-vol-task','screenIn')" id="task-notif">
            <div class="task-notif-top">
              <div>
                <div class="task-notif-badge">üîî NEW PICKUP REQUEST</div>
                <div style="height:8px"></div>
                <div class="task-rest-name">Spice Garden</div>
                <div class="task-address">üìç Madhapur Main Rd, 1.2km away</div>
              </div>
              <div style="text-align:right">
                <div style="font-family:var(--font-h);font-size:1.1rem;font-weight:700;color:var(--amber)">+120 XP</div>
                <div style="font-size:.68rem;color:var(--muted);margin-top:4px">reward</div>
              </div>
            </div>
            <div class="task-meta">
              <span class="chip chip-lime">üçõ 8 kg</span>
              <span class="chip chip-amber">üìç ‚Üí Akshaya Patra</span>
              <span class="chip chip-cyan">~25 min</span>
            </div>
            <div style="margin-top:12px">
              <div
                style="display:flex;justify-content:space-between;font-size:.72rem;color:var(--muted);margin-bottom:4px">
                <span>Auto-reassign in</span>
                <span style="color:var(--hot);font-family:var(--font-m)" id="task-timer">60s</span>
              </div>
              <div style="height:3px;background:var(--panel);border-radius:2px;overflow:hidden">
                <div style="height:100%;background:var(--hot);border-radius:2px;transition:width 1s linear"
                  id="task-timer-bar" style="width:100%"></div>
              </div>
            </div>
          </div>

          <div style="padding:0 20px 16px">
            <button class="btn btn-primary" onclick="acceptVolTask()">Accept Task ‚ö°</button>
            <button class="btn btn-danger" style="margin-top:8px" onclick="declineTask()">Decline Task</button>
          </div>

          <div class="leaderboard-section">
            <div class="section-label" style="margin-bottom:12px">City Leaderboard ‚Äî Madhapur</div>
            <div class="lb-item">
              <div class="lb-rank" style="color:#ffd700;font-weight:700">ü•á</div>
              <div class="lb-avatar">üë©</div>
              <div>
                <div class="lb-name">Priya S.</div>
                <div class="lb-xp">4,920 XP</div>
              </div>
              <div class="lb-pts">4920</div>
            </div>
            <div class="lb-item">
              <div class="lb-rank" style="color:#c0c0c0;font-weight:700">ü•à</div>
              <div class="lb-avatar">üë®</div>
              <div>
                <div class="lb-name">Arjun K.</div>
                <div class="lb-xp">4,210 XP</div>
              </div>
              <div class="lb-pts">4210</div>
            </div>
            <div class="lb-item me">
              <div class="lb-rank" style="color:#cd7f32;font-weight:700">ü•â</div>
              <div class="lb-avatar">üßë</div>
              <div>
                <div class="lb-name">Raza M. (You)</div>
                <div class="lb-xp" id="lb-my-xp">3,840 XP</div>
              </div>
              <div class="lb-pts" style="color:var(--lime)" id="lb-my-pts">3840</div>
            </div>
            <div class="lb-item">
              <div class="lb-rank" style="color:var(--muted)">4</div>
              <div class="lb-avatar">üë©‚Äçü¶±</div>
              <div>
                <div class="lb-name">Sneha D.</div>
                <div class="lb-xp">3,210 XP</div>
              </div>
              <div class="lb-pts">3210</div>
            </div>
          </div>
        </div>
        <div class="bottom-nav" id="vol-nav">
          <div class="nav-item nav-blue active" id="vol-nav-home" onclick="setVolNav('home',this)">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">HOME</div>
          </div>
          <div class="nav-item nav-blue" id="vol-nav-tasks"
            onclick="setVolNav('tasks',this);goTo('screen-vol-task','screenIn')">
            <div class="nav-icon">üì¶</div>
            <div class="nav-label">TASKS</div>
          </div>
          <div class="nav-item nav-blue" id="vol-nav-ranks"
            onclick="setVolNav('ranks',this);goTo('screen-vol-ranks','screenIn')">
            <div class="nav-icon">üèÜ</div>
            <div class="nav-label">RANKS</div>
          </div>
          <div class="nav-item nav-blue" onclick="goTo('screen-role','screenBack')">
            <div class="nav-icon">‚Ü©</div>
            <div class="nav-label">ROLES</div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VOL TASK ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-vol-task">
        <div class="app-header">
          <div class="back-btn" onclick="goTo('screen-volunteer','screenBack')">‚Äπ</div>
          <div class="header-title">Task #F-2847</div>
          <span class="chip chip-lime" id="task-status-badge">ACCEPTED</span>
        </div>
        <div class="scrollable" style="padding:20px 20px 80px">
          <div
            style="background:var(--surface);border:1px solid rgba(184,249,40,.25);border-radius:16px;padding:16px;margin-bottom:16px">
            <div class="section-label" style="margin-bottom:10px">PICKUP FROM</div>
            <div style="display:flex;gap:12px;align-items:center">
              <div style="font-size:2rem">üçΩÔ∏è</div>
              <div>
                <div style="font-weight:700">Spice Garden</div>
                <div style="font-size:.78rem;color:var(--muted)">Madhapur Main Rd ¬∑ 1.2 km</div>
              </div>
              <button class="btn btn-secondary btn-sm" style="margin-left:auto"
                onclick="openNavigation(17.4474, 78.3762, 'Spice Garden')">Navigate</button>
            </div>
          </div>
          <div
            style="background:var(--surface);border:1px solid rgba(6,214,160,.2);border-radius:16px;padding:16px;margin-bottom:16px">
            <div class="section-label" style="margin-bottom:10px">DELIVER TO</div>
            <div style="display:flex;gap:12px;align-items:center">
              <div style="font-size:2rem">üè†</div>
              <div>
                <div style="font-weight:700">Akshaya Patra</div>
                <div style="font-size:.78rem;color:var(--muted)">Kondapur Main Rd ¬∑ 3.8 km</div>
              </div>
              <button class="btn btn-secondary btn-sm" style="margin-left:auto"
                onclick="openNavigation(17.4581, 78.3548, 'Akshaya Patra')">Navigate</button>
            </div>
          </div>
          <div
            style="background:var(--surface);border:1px solid var(--border);border-radius:16px;padding:16px;margin-bottom:16px">
            <div class="section-label" style="margin-bottom:10px">CARGO</div>
            <div style="display:flex;gap:8px;flex-wrap:wrap;margin-bottom:10px">
              <span class="chip chip-lime">üçõ Chicken Biryani</span>
              <span class="chip chip-amber">8 kg</span>
              <span class="chip chip-blue">~25 portions</span>
            </div>
            <div style="font-size:.78rem;color:var(--muted)">Handle with care ¬∑ No allergens flagged except spice</div>
          </div>
          <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:16px">
            <button class="btn btn-primary" onclick="goTo('screen-tracking','screenIn')">üó∫ Track Route</button>
            <button class="btn btn-secondary" onclick="fakeQrScan(this)">üì∑ Scan QR</button>
          </div>
          <div
            style="background:rgba(255,159,10,.06);border:1px solid rgba(255,159,10,.2);border-radius:14px;padding:14px;margin-bottom:16px">
            <div style="display:flex;justify-content:space-between;margin-bottom:4px">
              <span style="font-size:.8rem;color:var(--muted)">XP Reward</span>
              <span style="font-family:var(--font-h);font-weight:700;color:var(--amber)">+120 XP</span>
            </div>
            <div style="display:flex;justify-content:space-between">
              <span style="font-size:.8rem;color:var(--muted)">Est. Duration</span>
              <span style="font-size:.82rem">~25 min</span>
            </div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê TRACKING ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-tracking">
        <div class="app-header">
          <div class="back-btn" onclick="goTo('screen-restaurant','screenBack')">‚Äπ</div>
          <div class="header-title">Live Tracking</div>
          <div class="header-badge" id="tracking-badge">EN ROUTE</div>
        </div>
        <div class="tracking-map" id="tracking-map-wrap">
          <div id="tracking-leaflet-map" style="width:100%;height:100%;border-radius:0"></div>
          <!-- Floating rider card on map -->
          <div id="rider-float-card"
            style="position:absolute;bottom:12px;left:12px;right:12px;z-index:400;background:var(--base);border:1px solid var(--border);border-radius:14px;padding:10px 14px;display:flex;align-items:center;gap:10px;backdrop-filter:blur(16px);box-shadow:0 8px 24px rgba(0,0,0,0.3)">
            <div
              style="width:36px;height:36px;border-radius:10px;background:rgba(184,249,40,0.12);border:1px solid rgba(184,249,40,0.25);display:flex;align-items:center;justify-content:center;font-size:18px;animation:floatGentle 2s ease-in-out infinite">
              üõµ</div>
            <div style="flex:1;min-width:0">
              <div style="font-weight:600;font-size:.82rem">Raza is on the way</div>
              <div style="font-size:.68rem;color:var(--muted);font-family:var(--font-m)" id="rider-distance-text">1.2 km
                remaining</div>
            </div>
            <div style="text-align:right">
              <div style="font-family:var(--font-h);font-weight:800;font-size:1.1rem;color:var(--lime)"
                id="rider-eta-mini">18</div>
              <div style="font-size:.55rem;color:var(--muted);font-family:var(--font-m)">MIN</div>
            </div>
          </div>
        </div>
        <div class="tracking-info">
          <div class="tracking-eta">
            <div>
              <div class="eta-time" id="eta-countdown">18</div>
              <div class="eta-label">MIN ETA</div>
            </div>
            <div class="eta-divider"></div>
            <div>
              <div style="font-weight:600;font-size:.9rem;margin-bottom:3px">Raza Mirza üõµ</div>
              <div class="eta-address">En route ¬∑ 1.2km remaining<br><span
                  style="color:var(--lime);font-family:var(--font-m);font-size:.7rem">‚òÖ‚òÖ‚òÖ‚òÖ‚òÖ 4.9 rating</span></div>
            </div>
            <button class="btn btn-secondary btn-sm" style="margin-left:auto;flex-shrink:0"
              onclick="showToast('üí¨ Chat opened!')">üí¨</button>
          </div>
          <div class="progress-track">
            <div class="progress-title">Delivery Progress</div>
            <div class="progress-step done" id="p1">
              <div class="p-icon">‚úÖ</div>
              <div>
                <div class="p-label">Donation Listed</div>
                <div class="p-sub">Spice Garden ¬∑ 14:30</div>
              </div>
            </div>
            <div class="progress-step done" id="p2">
              <div class="p-icon">‚úÖ</div>
              <div>
                <div class="p-label">Volunteer Matched</div>
                <div class="p-sub">Raza M. accepted ¬∑ 14:48</div>
              </div>
            </div>
            <div class="progress-step active" id="p3">
              <div class="p-icon">üõµ</div>
              <div>
                <div class="p-label">Pickup In Progress</div>
                <div class="p-sub">ETA at restaurant: 3 min</div>
              </div>
            </div>
            <div class="progress-step" id="p4">
              <div class="p-icon">üì¶</div>
              <div>
                <div class="p-label">Food Picked Up</div>
                <div class="p-sub">QR scan pending</div>
              </div>
            </div>
            <div class="progress-step" id="p5">
              <div class="p-icon">üè†</div>
              <div>
                <div class="p-label">Delivered to NGO</div>
                <div class="p-sub">Akshaya Patra, Kondapur</div>
              </div>
            </div>
          </div>
          <button class="btn btn-primary" onclick="simulateDelivery()">‚ö° Fast-Forward Delivery</button>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê SUCCESS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-success">
        <div class="confetti-container" id="confetti-container"></div>
        <div class="success-inner">
          <div class="success-icon-wrap">üéâ</div>
          <div class="success-title">Food Delivered!</div>
          <div class="success-sub" id="success-desc">8 kg of Chicken Biryani delivered to Akshaya Patra. You just fed 25
            people!</div>
          <div class="impact-reveal">
            <div class="impact-reveal-col">
              <div class="ir-val" id="suc-meals">25</div>
              <div class="ir-label">MEALS</div>
            </div>
            <div class="impact-reveal-col">
              <div class="ir-val" id="suc-kg">8kg</div>
              <div class="ir-label">SAVED</div>
            </div>
            <div class="impact-reveal-col">
              <div class="ir-val" id="suc-co2">5kg</div>
              <div class="ir-label">CO‚ÇÇ‚Üì</div>
            </div>
          </div>
          <div
            style="background:rgba(184,249,40,.05);border:1px solid rgba(184,249,40,.2);border-radius:14px;padding:16px;margin-bottom:20px;text-align:left">
            <div class="section-label" style="margin-bottom:8px">DELIVERY CERTIFICATE</div>
            <div
              style="display:flex;justify-content:space-between;font-size:.8rem;color:var(--muted);margin-bottom:6px">
              <span>Donation ID</span><span style="color:var(--white);font-family:var(--font-m)"
                id="suc-id">#F-2847</span>
            </div>
            <div
              style="display:flex;justify-content:space-between;font-size:.8rem;color:var(--muted);margin-bottom:6px">
              <span>Donor</span><span style="color:var(--white)">Spice Garden</span>
            </div>
            <div
              style="display:flex;justify-content:space-between;font-size:.8rem;color:var(--muted);margin-bottom:6px">
              <span>Recipient</span><span style="color:var(--white)">Akshaya Patra</span>
            </div>
            <div style="display:flex;justify-content:space-between;font-size:.8rem;color:var(--muted)">
              <span>Timestamp</span><span style="color:var(--lime);font-family:var(--font-m)" id="suc-time">15:22:47
                IST</span>
            </div>
          </div>
          <button class="btn btn-primary" onclick="shareImpactCard()" style="margin-bottom:10px">üì§
            Share Impact Card</button>
          <button class="btn btn-secondary" onclick="goTo('screen-restaurant','screenBack')">‚Üê Back to
            Dashboard</button>
          <div
            style="margin-top:28px;text-align:center;font-size:.7rem;color:rgba(200,215,230,.2);font-family:var(--font-m);letter-spacing:.08em">
            Made with <span style="color:var(--hot);animation:heartbeat 1.4s ease-in-out infinite;display:inline-block"
              id="heart">‚ô•</span> by <span style="color:var(--lime)">Aamina</span>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NGO FULL MAP SCREEN ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-ngo-map">
        <div class="app-header">
          <div class="back-btn"
            onclick="goTo('screen-ngo','screenBack');setNgoNav('home',document.getElementById('ngo-nav-home'))">‚Äπ</div>
          <div class="header-title">Live Map</div>
          <span class="chip chip-cyan" id="full-map-badge" style="font-size:.58rem">LOADING...</span>
        </div>
        <!-- Full height map -->
        <div
          style="position:relative;flex:1;min-height:0;margin:0 12px 8px;border-radius:18px;overflow:hidden;border:1px solid var(--border)">
          <div id="full-map-loading" class="map-loading">
            <div class="loading-dots"><span></span><span></span><span></span></div>
            <div class="map-loading-text">LOADING MAP...</div>
          </div>
          <div id="full-map" style="width:100%;height:100%;border-radius:18px"></div>
          <div
            style="position:absolute;top:12px;left:12px;z-index:400;padding:5px 12px;border-radius:8px;background:rgba(13,17,23,.9);backdrop-filter:blur(10px);border:1px solid rgba(6,214,160,.25);font-family:var(--font-m);font-size:.62rem;color:var(--cyan);letter-spacing:.06em"
            id="full-map-label">üìç Finding location...</div>
        </div>
        <!-- Legend + NGO list below map -->
        <div style="padding:0 12px 8px;display:flex;gap:12px;flex-wrap:wrap">
          <div class="legend-dot"><span
              style="background:#b8f928;width:8px;height:8px;border-radius:50%;display:inline-block"></span><span
              style="font-family:var(--font-m);font-size:.6rem;color:var(--muted)">NGO/Shelter</span></div>
          <div class="legend-dot"><span
              style="background:#ff9f0a;width:8px;height:8px;border-radius:50%;display:inline-block"></span><span
              style="font-family:var(--font-m);font-size:.6rem;color:var(--muted)">Active Pickup</span></div>
          <div class="legend-dot"><span
              style="background:#06d6a0;width:8px;height:8px;border-radius:50%;display:inline-block"></span><span
              style="font-family:var(--font-m);font-size:.6rem;color:var(--muted)">You</span></div>
        </div>
        <div style="padding:0 12px 8px">
          <div
            style="font-family:var(--font-m);font-size:.62rem;color:var(--muted);letter-spacing:.1em;text-transform:uppercase;margin-bottom:8px">
            NEARBY NGOS</div>
          <div id="nearby-ngo-list"
            style="display:flex;flex-direction:column;gap:6px;max-height:160px;overflow-y:auto;scrollbar-width:none">
            <div style="text-align:center;padding:20px;color:var(--muted);font-size:.8rem">Searching nearby...</div>
          </div>
        </div>
        <div class="bottom-nav">
          <div class="nav-item nav-cyan"
            onclick="setNgoNav('home',document.getElementById('ngo-nav-home'));goTo('screen-ngo','screenBack')">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">HOME</div>
          </div>
          <div class="nav-item nav-cyan active">
            <div class="nav-icon">üó∫</div>
            <div class="nav-label">MAP</div>
          </div>
          <div class="nav-item nav-cyan"
            onclick="setNgoNav('hist',document.getElementById('ngo-nav-hist'));goTo('screen-ngo-history','screenIn')">
            <div class="nav-icon">üìã</div>
            <div class="nav-label">HISTORY</div>
          </div>
          <div class="nav-item nav-cyan" onclick="goTo('screen-role','screenBack')">
            <div class="nav-icon">‚Ü©</div>
            <div class="nav-label">ROLES</div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê NGO HISTORY ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-ngo-history">
        <div class="app-header">
          <div class="back-btn"
            onclick="goTo('screen-ngo','screenBack');setNgoNav('home',document.getElementById('ngo-nav-home'))">‚Äπ</div>
          <div class="header-title">Donation History</div>
          <div class="header-badge" id="hist-total-badge"
            style="background:rgba(6,214,160,.1);color:var(--cyan);border-color:rgba(6,214,160,.2)">0 received</div>
        </div>
        <!-- Summary stats -->
        <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;padding:14px 16px 0">
          <div
            style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px 10px;text-align:center">
            <div style="font-family:var(--font-h);font-weight:800;font-size:1.4rem;color:var(--cyan)"
              id="hist-total-kg">83</div>
            <div style="font-size:.6rem;color:var(--muted);font-family:var(--font-m);margin-top:2px">KG RECEIVED</div>
          </div>
          <div
            style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px 10px;text-align:center">
            <div style="font-family:var(--font-h);font-weight:800;font-size:1.4rem;color:var(--lime)"
              id="hist-total-meals">247</div>
            <div style="font-size:.6rem;color:var(--muted);font-family:var(--font-m);margin-top:2px">MEALS SERVED</div>
          </div>
          <div
            style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px 10px;text-align:center">
            <div style="font-family:var(--font-h);font-weight:800;font-size:1.4rem;color:var(--amber)"
              id="hist-donors-count">5</div>
            <div style="font-size:.6rem;color:var(--muted);font-family:var(--font-m);margin-top:2px">DONORS</div>
          </div>
        </div>
        <!-- Filter bar -->
        <div class="filter-row" style="margin-top:14px">
          <div class="filter-chip active" onclick="filterHistory('all',this)"
            style="border-color:rgba(6,214,160,.3);color:var(--cyan);background:rgba(6,214,160,.1)">All</div>
          <div class="filter-chip" onclick="filterHistory('delivered',this)">‚úÖ Delivered</div>
          <div class="filter-chip" onclick="filterHistory('live',this)">üü¢ Live</div>
          <div class="filter-chip" onclick="filterHistory('picked',this)">üü° In Transit</div>
        </div>
        <div class="scrollable" id="ngo-history-list"
          style="padding:0 16px 30px;display:flex;flex-direction:column;gap:8px"></div>
        <div class="bottom-nav">
          <div class="nav-item nav-cyan"
            onclick="setNgoNav('home',document.getElementById('ngo-nav-home'));goTo('screen-ngo','screenBack')">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">HOME</div>
          </div>
          <div class="nav-item nav-cyan"
            onclick="setNgoNav('map',document.getElementById('ngo-nav-map'));goTo('screen-ngo-map','screenIn')">
            <div class="nav-icon">üó∫</div>
            <div class="nav-label">MAP</div>
          </div>
          <div class="nav-item nav-cyan active">
            <div class="nav-icon">üìã</div>
            <div class="nav-label">HISTORY</div>
          </div>
          <div class="nav-item nav-cyan" onclick="goTo('screen-role','screenBack')">
            <div class="nav-icon">‚Ü©</div>
            <div class="nav-label">ROLES</div>
          </div>
        </div>
      </div>

      <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê VOLUNTEER RANKS ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
      <div class="screen" id="screen-vol-ranks">
        <div class="app-header">
          <div class="back-btn"
            onclick="goTo('screen-volunteer','screenBack');setVolNav('home',document.getElementById('vol-nav-home'))">‚Äπ
          </div>
          <div class="header-title">City Leaderboard</div>
          <span class="chip chip-blue" style="font-size:.58rem">MADHAPUR</span>
        </div>
        <div class="scrollable" style="padding:0 16px 30px">
          <!-- My rank card -->
          <div
            style="background:rgba(74,158,255,.06);border:1px solid rgba(74,158,255,.25);border-radius:16px;padding:16px;margin:16px 0;display:flex;align-items:center;gap:14px">
            <div
              style="width:48px;height:48px;border-radius:14px;background:rgba(74,158,255,.12);border:2px solid rgba(74,158,255,.3);display:flex;align-items:center;justify-content:center;font-size:22px">
              üßë</div>
            <div style="flex:1">
              <div style="font-family:var(--font-h);font-weight:700;font-size:1rem;margin-bottom:2px">Raza Mirza</div>
              <div style="font-size:.72rem;color:var(--muted)">Level 8 ¬∑ 142 deliveries</div>
              <div style="height:4px;background:var(--panel);border-radius:2px;margin-top:8px;overflow:hidden">
                <div
                  style="height:100%;width:78%;background:linear-gradient(to right,var(--blue),var(--cyan));border-radius:2px;transition:width 1.5s .3s">
                </div>
              </div>
              <div
                style="display:flex;justify-content:space-between;margin-top:4px;font-family:var(--font-m);font-size:.58rem;color:var(--muted)">
                <span>Level 8</span><span id="rank-xp-text">3,840 / 5,000 XP ‚Üí Level 9</span>
              </div>
            </div>
            <div style="text-align:right">
              <div style="font-family:var(--font-h);font-weight:800;font-size:1.6rem;color:var(--blue)">#3</div>
              <div style="font-size:.62rem;color:var(--muted);font-family:var(--font-m)">CITY RANK</div>
            </div>
          </div>
          <!-- Full leaderboard -->
          <div
            style="font-family:var(--font-m);font-size:.62rem;color:var(--muted);letter-spacing:.1em;text-transform:uppercase;margin-bottom:10px">
            TOP RIDERS ‚Äî ALL TIME</div>
          <div id="full-leaderboard">
            <!-- Rendered by JS -->
          </div>
          <!-- Badges -->
          <div
            style="font-family:var(--font-m);font-size:.62rem;color:var(--muted);letter-spacing:.1em;text-transform:uppercase;margin:16px 0 10px">
            YOUR BADGES</div>
          <div style="display:grid;grid-template-columns:repeat(3,1fr);gap:8px;margin-bottom:20px">
            <div
              style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center">
              <div style="font-size:1.5rem;margin-bottom:4px">üèÖ</div>
              <div style="font-size:.65rem;color:var(--white);font-weight:600">Fast Rider</div>
              <div style="font-size:.58rem;color:var(--muted)">Under 20min avg</div>
            </div>
            <div
              style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px;text-align:center">
              <div style="font-size:1.5rem;margin-bottom:4px">üíö</div>
              <div style="font-size:.65rem;color:var(--white);font-weight:600">Zero Miss</div>
              <div style="font-size:.58rem;color:var(--muted)">30 days streak</div>
            </div>
            <div
              style="background:var(--surface);border:1px solid rgba(184,249,40,.2);border-radius:12px;padding:12px;text-align:center;background:rgba(184,249,40,.04)">
              <div style="font-size:1.5rem;margin-bottom:4px">üåü</div>
              <div style="font-size:.65rem;color:var(--lime);font-weight:600">Top 5</div>
              <div style="font-size:.58rem;color:var(--muted)">City ranking</div>
            </div>
          </div>
        </div>
        <div class="bottom-nav">
          <div class="nav-item nav-blue"
            onclick="setVolNav('home',document.getElementById('vol-nav-home'));goTo('screen-volunteer','screenBack')">
            <div class="nav-icon">üè†</div>
            <div class="nav-label">HOME</div>
          </div>
          <div class="nav-item nav-blue"
            onclick="setVolNav('tasks',document.getElementById('vol-nav-tasks'));goTo('screen-vol-task','screenIn')">
            <div class="nav-icon">üì¶</div>
            <div class="nav-label">TASKS</div>
          </div>
          <div class="nav-item nav-blue active">
            <div class="nav-icon">üèÜ</div>
            <div class="nav-label">RANKS</div>
          </div>
          <div class="nav-item nav-blue" onclick="goTo('screen-role','screenBack')">
            <div class="nav-icon">‚Ü©</div>
            <div class="nav-label">ROLES</div>
          </div>
        </div>
      </div>

    </div>
  </div><!-- /phone /app -->

  <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.min.js"></script>
  <script>
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const foodEmojis = {
      'Biryani': 'üçõ', 'Curry': 'üç≤', 'Breads': 'üçû', 'Salad': 'ü•ó',
      'Desserts': 'üçÆ', 'Beverages': 'ü•§', 'Packaged': 'üì¶', 'Mixed Meal': 'üç±'
    };
    const foodColors = {
      'Biryani': 'rgba(184,249,40,0.1)', 'Curry': 'rgba(255,159,10,0.1)',
      'Breads': 'rgba(74,158,255,0.1)', 'Salad': 'rgba(6,214,160,0.1)',
      'Desserts': 'rgba(155,92,255,0.1)', 'Beverages': 'rgba(74,158,255,0.1)',
      'Packaged': 'rgba(200,215,230,0.08)', 'Mixed Meal': 'rgba(184,249,40,0.1)'
    };
    const volunteers = ['Raza M.', 'Priya S.', 'Arjun K.', 'Sneha D.', 'Vikram P.'];

    const STATE = {
      donations: [
        { id: 'F-1001', type: 'Biryani', qty: 8, portions: 25, time: '14:30', status: 'delivered', volunteer: 'Raza M.', day: 'Today', allergens: ['Spicy'] },
        { id: 'F-1002', type: 'Curry', qty: 5, portions: 16, time: '12:15', status: 'live', volunteer: 'Priya S.', day: 'Today', allergens: ['Dairy-free'] },
        { id: 'F-1003', type: 'Breads', qty: 3, portions: 10, time: '19:00', status: 'delivered', volunteer: 'Arjun K.', day: 'Yesterday', allergens: ['Gluten'] },
        { id: 'F-1004', type: 'Salad', qty: 2, portions: 8, time: '11:00', status: 'delivered', volunteer: 'Sneha D.', day: 'Yesterday', allergens: ['Vegan'] },
        { id: 'F-1005', type: 'Mixed Meal', qty: 6, portions: 20, time: '13:30', status: 'picked', volunteer: 'Vikram P.', day: 'Yesterday', allergens: [] },
      ],
      stats: { meals: 247, kg: 83, count: 32, frs: 94 },
      volXP: 3840,
      taskActive: true,
      taskSeconds: 60,
      hygieneChecked: false,
      photoUploaded: false,
      nextId: 1006,
      activeFilter: 'all'
    };

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  MODAL
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function closeModal() {
      const overlay = document.getElementById('modal-overlay');
      if (overlay) overlay.classList.remove('open');
    }
    function openModal(html) {
      const overlay = document.getElementById('modal-overlay');
      const content = document.getElementById('modal-content');
      if (content) content.innerHTML = html;
      if (overlay) overlay.classList.add('open');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  BG CANVAS PARTICLES
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const bgCanvas = document.getElementById('bg-canvas');
    const bgCtx = bgCanvas.getContext('2d');
    let BW, BH;
    function resizeBg() { BW = bgCanvas.width = window.innerWidth; BH = bgCanvas.height = window.innerHeight; }
    resizeBg(); window.addEventListener('resize', resizeBg);
    const bgP = Array.from({ length: 100 }, () => ({
      x: Math.random() * 2000, y: Math.random() * 1200,
      r: Math.random() * 1.5 + 0.2, vx: (Math.random() - .5) * .18, vy: (Math.random() - .5) * .18,
      a: Math.random() * .25 + .03, c: Math.random() > .6 ? '184,249,40' : Math.random() > .3 ? '255,159,10' : '6,214,160'
    }));
    function animBg() {
      bgCtx.clearRect(0, 0, BW, BH);
      // Draw connection lines between nearby particles
      for (let i = 0; i < bgP.length; i++) {
        for (let j = i + 1; j < bgP.length; j++) {
          const dx = bgP[i].x - bgP[j].x, dy = bgP[i].y - bgP[j].y;
          const dist = Math.sqrt(dx * dx + dy * dy);
          if (dist < 120) {
            bgCtx.beginPath();
            bgCtx.moveTo(bgP[i].x, bgP[i].y);
            bgCtx.lineTo(bgP[j].x, bgP[j].y);
            bgCtx.strokeStyle = `rgba(184,249,40,${0.03 * (1 - dist / 120)})`;
            bgCtx.lineWidth = 0.5;
            bgCtx.stroke();
          }
        }
      }
      // Draw particles
      bgP.forEach(p => {
        p.x += p.vx; p.y += p.vy;
        if (p.x < 0 || p.x > BW) p.vx *= -1; if (p.y < 0 || p.y > BH) p.vy *= -1;
        bgCtx.beginPath(); bgCtx.arc(p.x, p.y, p.r, 0, Math.PI * 2);
        bgCtx.fillStyle = `rgba(${p.c},${p.a})`; bgCtx.fill();
      });
      requestAnimationFrame(animBg);
    }
    animBg();

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  SCREEN NAVIGATION
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let currentScreen = 'screen-splash';
    function goTo(id, anim) {
      if (id === currentScreen) return;
      const prev = document.getElementById(currentScreen);
      const next = document.getElementById(id);
      if (!next) return;
      prev.style.display = 'none';
      prev.classList.remove('active', 'slide-back');
      next.classList.remove('active', 'slide-back');
      next.style.display = 'flex';
      void next.offsetWidth;
      next.classList.add(anim === 'screenBack' ? 'slide-back' : 'active');
      currentScreen = id;
      onScreenEnter(id);
    }

    function onScreenEnter(id) {
      if (id === 'screen-restaurant') { refreshRestaurant(); }
      if (id === 'screen-ngo') { setTimeout(initNgoMap, 100); }
      if (id === 'screen-ngo-map') { setTimeout(initFullMap, 120); }
      if (id === 'screen-ngo-history') { renderNgoHistory(); }
      if (id === 'screen-vol-ranks') { renderFullLeaderboard(); }
      if (id === 'screen-tracking') { setTimeout(initTrackingMap, 100); }
      if (id === 'screen-success') { setTimeout(launchConfetti, 300); updateSuccessTime(); }
      if (id === 'screen-broadcast') { startBroadcast(); }
      if (id === 'screen-all-donations') { renderAllDonations(); }
      if (id === 'screen-impact') { setTimeout(renderImpact, 100); }
    }

    function enterRole(role) {
      const screens = { restaurant: 'screen-restaurant', ngo: 'screen-ngo', volunteer: 'screen-volunteer' };
      goTo(screens[role], 'screenIn');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  SPLASH AUTO-ADVANCE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    setTimeout(() => goTo('screen-role', 'screenIn'), 3000);

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  LEAFLET MAP TILE SUPPORT (must be before applyTheme)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    const TILE_DARK = 'https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png';
    const TILE_LIGHT = 'https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png';
    const TILE_OPTS = { subdomains: 'abcd', maxZoom: 19 };
    let ngoTileLayer = null;
    let fullTileLayer = null;
    let ngoMap = null;
    let fullMap = null;

    function getTileUrl() {
      return (localStorage.getItem('faarz-theme') || 'dark') === 'light' ? TILE_LIGHT : TILE_DARK;
    }
    function swapMapTiles(theme) {
      const url = theme === 'light' ? TILE_LIGHT : TILE_DARK;
      try {
        if (ngoTileLayer && ngoMap) {
          ngoMap.removeLayer(ngoTileLayer);
          ngoTileLayer = L.tileLayer(url, TILE_OPTS).addTo(ngoMap);
          ngoTileLayer.bringToBack();
        }
        if (fullTileLayer && fullMap) {
          fullMap.removeLayer(fullTileLayer);
          fullTileLayer = L.tileLayer(url, TILE_OPTS).addTo(fullMap);
          fullTileLayer.bringToBack();
        }
        if (trackingTileLayer && trackingMap) {
          trackingMap.removeLayer(trackingTileLayer);
          trackingTileLayer = L.tileLayer(url, TILE_OPTS).addTo(trackingMap);
          trackingTileLayer.bringToBack();
        }
      } catch (e) { /* maps not initialized yet */ }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  THEME TOGGLE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function getTheme() {
      return localStorage.getItem('faarz-theme') || 'dark';
    }
    function applyTheme(theme) {
      document.documentElement.setAttribute('data-theme', theme);
      const icon = document.getElementById('theme-icon');
      if (icon) icon.textContent = theme === 'light' ? '‚òÄÔ∏è' : 'üåô';
      // Update meta theme-color for mobile browsers
      const meta = document.querySelector('meta[name="theme-color"]');
      if (meta) meta.content = theme === 'light' ? '#f0f2f5' : '#060709';
      // Update particle colors for current theme
      if (typeof bgP !== 'undefined') {
        bgP.forEach(p => {
          if (theme === 'light') {
            p.c = Math.random() > 0.6 ? '101,163,13' : Math.random() > 0.3 ? '217,119,6' : '5,150,105';
            p.a = Math.random() * 0.12 + 0.02;
          } else {
            p.c = Math.random() > 0.6 ? '184,249,40' : Math.random() > 0.3 ? '255,159,10' : '6,214,160';
            p.a = Math.random() * 0.25 + 0.03;
          }
        });
      }
      // Swap Leaflet map tile layers between dark and light
      swapMapTiles(theme);
    }
    function toggleTheme() {
      const current = getTheme();
      const next = current === 'dark' ? 'light' : 'dark';
      localStorage.setItem('faarz-theme', next);
      applyTheme(next);
    }
    // Apply saved theme on load
    applyTheme(getTheme());

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  TOAST
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let toastTimer;
    function showToast(msg) {
      const t = document.getElementById('toast');
      t.textContent = msg; t.classList.add('show');
      clearTimeout(toastTimer);
      toastTimer = setTimeout(() => t.classList.remove('show'), 2500);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  RESTAURANT DASHBOARD ‚Äî DYNAMIC RENDER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function refreshRestaurant() {
      setGreeting();
      renderStats();
      renderRecentDonations();
      animateFrsBar();
      animateCounters();
    }

    function setGreeting() {
      const h = new Date().getHours();
      const greet = h < 12 ? 'Good morning üëã' : h < 17 ? 'Good afternoon üëã' : 'Good evening üëã';
      const el = document.getElementById('rest-greeting');
      if (el) el.textContent = greet;
    }

    function renderStats() {
      const { meals, kg, count, frs } = STATE.stats;
      setText('stat-meals', meals);
      setText('stat-kg', kg);
      setText('stat-count', count);
      setText('frs-score-text', frs + ' / 100');
      const rankEl = document.getElementById('frs-rank-text');
      if (rankEl) rankEl.textContent = frs >= 90 ? 'üèÜ Ranked #1 in Madhapur HITEC Zone' : frs >= 75 ? 'ü•à Ranked #4 in Madhapur HITEC Zone' : 'üìà Keep donating to improve your rank!';
      const chip = document.getElementById('rest-rank-chip');
      if (chip) chip.textContent = count >= 30 ? 'üèÜ Top Donor' : count >= 15 ? 'üåü Active Donor' : 'üå± New Partner';
      const nearby = document.getElementById('ngo-nearby-text');
      if (nearby) nearby.textContent = `${Math.floor(Math.random() * 2) + 1} NGOs are active nearby`;
    }

    function renderRecentDonations() {
      const container = document.getElementById('recent-list');
      if (!container) return;
      const recent = [...STATE.donations].reverse().slice(0, 4);
      if (recent.length === 0) {
        container.innerHTML = `<div class="empty-state"><div class="empty-icon">üç±</div><div class="empty-text">No donations yet.<br>Tap "Donate Food Now" to get started!</div></div>`;
        return;
      }
      container.innerHTML = recent.map(d => donationItemHTML(d)).join('');
    }

    function donationItemHTML(d) {
      const emoji = foodEmojis[d.type] || 'üç±';
      const color = foodColors[d.type] || 'rgba(184,249,40,0.1)';
      const statusMap = {
        live: { cls: 'status-live', color: 'var(--lime)', label: 'Live', dot: 'status-live' },
        picked: { cls: 'status-picked', color: 'var(--amber)', label: 'Picked Up', dot: 'status-picked' },
        delivered: { cls: 'status-done', color: 'var(--cyan)', label: 'Delivered', dot: 'status-done' },
        pending: { cls: 'status-pending', color: 'var(--muted)', label: 'Pending', dot: 'status-pending' }
      };
      const s = statusMap[d.status] || statusMap.pending;
      const vol = d.volunteer ? ` ¬∑ ${d.volunteer}` : '';
      return `<div class="donation-item" onclick="showToast('üìã Donation #${d.id} details')">
    <div class="d-icon" style="background:${color}">${emoji}</div>
    <div class="d-info">
      <div class="d-name">${d.type} ‚Äî ${d.qty} kg</div>
      <div class="d-meta">${d.day} ¬∑ ${d.time}${vol}</div>
    </div>
    <div class="d-status">
      <span class="status-dot ${s.dot}"></span>
      <span class="status-text" style="color:${s.color}">${s.label}</span>
    </div>
  </div>`;
    }

    function animateFrsBar() {
      const bar = document.getElementById('frs-bar');
      if (bar) { bar.style.width = '0%'; setTimeout(() => bar.style.width = STATE.stats.frs + '%', 200); }
    }

    function animateCounters() {
      const targets = {
        'stat-meals': STATE.stats.meals,
        'stat-kg': STATE.stats.kg,
        'stat-count': STATE.stats.count
      };
      Object.entries(targets).forEach(([id, target]) => {
        const el = document.getElementById(id);
        if (!el) return;
        let cur = 0; const dur = 1200; const start = Date.now();
        const tick = () => {
          const p = Math.min((Date.now() - start) / dur, 1);
          el.textContent = Math.round(p * target);
          if (p < 1) requestAnimationFrame(tick);
        };
        tick();
      });
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  BOTTOM NAV ACTIVE STATE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function setRestNav(tab, el) {
      ['rnav-home', 'rnav-donate', 'rnav-impact', 'rnav-roles'].forEach(id => {
        const n = document.getElementById(id);
        if (n) n.classList.remove('active');
      });
      if (el) el.classList.add('active');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  ALL DONATIONS SCREEN
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderAllDonations(filter) {
      const f = filter || STATE.activeFilter;
      const container = document.getElementById('all-donations-list');
      const badge = document.getElementById('all-count-badge');
      if (!container) return;
      const filtered = f === 'all' ? STATE.donations : STATE.donations.filter(d => d.status === f);
      if (badge) badge.textContent = `${filtered.length} total`;
      if (filtered.length === 0) {
        container.innerHTML = `<div class="empty-state" style="padding:40px 0"><div class="empty-icon">üì≠</div><div class="empty-text">No ${f} donations yet.</div></div>`;
        return;
      }
      container.innerHTML = [...filtered].reverse().map(d => `
    <div class="donation-item" style="cursor:default">
      <div class="d-icon" style="background:${foodColors[d.type] || 'rgba(184,249,40,0.1)'}">${foodEmojis[d.type] || 'üç±'}</div>
      <div class="d-info">
        <div class="d-name">${d.type} ‚Äî ${d.qty} kg</div>
        <div class="d-meta">${d.day} ¬∑ ${d.time}${d.volunteer ? ' ¬∑ ' + d.volunteer : ''}</div>
        ${d.allergens && d.allergens.length ? `<div style="margin-top:4px;display:flex;gap:4px;flex-wrap:wrap">${d.allergens.map(a => `<span class="chip chip-blue" style="font-size:.55rem">${a}</span>`).join('')}</div>` : ''}
      </div>
      <div class="d-status" style="display:flex;flex-direction:column;align-items:flex-end;gap:4px">
        <span class="status-dot ${d.status === 'live' ? 'status-live' : d.status === 'picked' ? 'status-picked' : d.status === 'delivered' ? 'status-done' : 'status-pending'}"></span>
        <span class="status-text" style="color:${d.status === 'live' ? 'var(--lime)' : d.status === 'picked' ? 'var(--amber)' : d.status === 'delivered' ? 'var(--cyan)' : 'var(--muted)'}">${d.status.charAt(0).toUpperCase() + d.status.slice(1)}</span>
        <span style="font-family:var(--font-m);font-size:.58rem;color:var(--muted)">#${d.id}</span>
      </div>
    </div>`).join('');
    }

    function filterDonations(filter, el) {
      STATE.activeFilter = filter;
      document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
      if (el) el.classList.add('active');
      renderAllDonations(filter);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  IMPACT SCREEN
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderImpact() {
      const s = STATE.stats;
      setText('impact-big-meals', s.meals);
      setText('impact-frs-num', s.frs);
      setText('impact-kg-total', s.kg);
      setText('impact-co2', Math.round(s.kg * 0.5));
      setText('impact-donations-total', s.count);
      setText('impact-ngos-reached', Math.min(3, Math.ceil(s.count / 10)));
      const frsBar = document.getElementById('impact-frs-bar');
      if (frsBar) { frsBar.style.width = '0%'; setTimeout(() => frsBar.style.width = s.frs + '%', 300); }
      renderBarChart();
    }

    function renderBarChart() {
      const bars = document.getElementById('chart-bars');
      const labels = document.getElementById('chart-labels');
      if (!bars || !labels) return;
      const data = [12, 8, 15, 5, 20, 18, 25]; // kg per day this week
      const days = ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'];
      const max = Math.max(...data);
      bars.innerHTML = data.map((v, i) => `
    <div class="chart-bar" style="height:${Math.round(v / max * 100)}%" title="${v} kg">
      <div class="bar-fill" style="height:0%;transition:height 1s ${i * 0.1}s cubic-bezier(0.4,0,0.2,1)"></div>
    </div>`).join('');
      labels.innerHTML = days.map(d => `<div class="chart-label">${d}</div>`).join('');
      setTimeout(() => {
        bars.querySelectorAll('.bar-fill').forEach((el, i) => {
          el.style.height = Math.round(data[i] / max * 100) + '%';
        });
      }, 150);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  DONATE FORM ‚Äî VALIDATION & SUBMISSION
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function toggleAllergen(el) { el.classList.toggle('selected'); }

    function toggleHygiene() {
      STATE.hygieneChecked = !STATE.hygieneChecked;
      const wrap = document.getElementById('hygiene-check');
      const box = document.getElementById('check-box');
      const err = document.getElementById('err-hygiene');
      wrap.classList.toggle('checked', STATE.hygieneChecked);
      box.textContent = STATE.hygieneChecked ? '‚úì' : '';
      box.style.background = STATE.hygieneChecked ? 'var(--cyan)' : 'var(--surface)';
      box.style.borderColor = STATE.hygieneChecked ? 'var(--cyan)' : 'var(--border)';
      box.style.color = '#0a0d06';
      if (STATE.hygieneChecked && err) err.classList.remove('show');
    }

    function fakePhotoUpload() {
      document.getElementById('photo-file-input')?.click();
    }

    function handlePhotoUpload(input) {
      const file = input.files?.[0];
      if (!file) return;
      STATE.photoUploaded = true;
      const zone = document.getElementById('photo-upload-zone');
      const icon = document.getElementById('photo-icon');
      const text = document.getElementById('photo-text');
      const preview = document.getElementById('photo-preview');
      if (!zone) return;
      zone.classList.add('uploaded');
      if (icon) icon.textContent = '‚úÖ';
      const sizeMB = (file.size / (1024 * 1024)).toFixed(1);
      if (text) text.innerHTML = `Photo uploaded!<br><span style="font-size:.68rem;color:var(--cyan)">${file.name} ¬∑ ${sizeMB} MB</span>`;
      // Show image preview
      if (preview && file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = (e) => {
          preview.src = e.target.result;
          preview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      }
    }

    function showErr(id, show) { const el = document.getElementById(id); if (el) el.classList.toggle('show', show); }

    function submitDonation() {
      const type = document.getElementById('f-type')?.value;
      const qty = parseFloat(document.getElementById('f-qty')?.value) || 0;
      const portions = parseInt(document.getElementById('f-portions')?.value) || Math.round(qty * 3);
      const prepared = document.getElementById('f-prepared')?.value || '';
      const from = document.getElementById('f-from')?.value || '';
      const until = document.getElementById('f-until')?.value || '';

      let valid = true;
      showErr('err-type', !type); if (!type) valid = false;
      showErr('err-qty', qty <= 0); if (qty <= 0) valid = false;
      showErr('err-hygiene', !STATE.hygieneChecked); if (!STATE.hygieneChecked) valid = false;
      if (!valid) { showToast('‚ö† Please fill in required fields'); return; }

      const allergens = [...document.querySelectorAll('.allergen-chip.selected')].map(c => c.dataset.tag || c.textContent.trim());
      const now = new Date();
      const timeStr = prepared || `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}`;
      const vol = volunteers[Math.floor(Math.random() * volunteers.length)];

      const newDonation = {
        id: `F-${STATE.nextId++}`,
        type, qty, portions, time: timeStr, status: 'live',
        volunteer: vol, day: 'Today', allergens
      };

      STATE.donations.push(newDonation);
      STATE.stats.count++;
      STATE.stats.kg += qty;
      STATE.stats.meals += portions;
      STATE.stats.frs = Math.min(100, STATE.stats.frs + Math.floor(qty));

      // Store data for broadcast & success screens
      window._lastDonation = newDonation;

      // Reset form
      resetDonateForm();
      goTo('screen-broadcast', 'screenIn');
    }

    function resetDonateForm() {
      const fields = ['f-type', 'f-qty', 'f-portions', 'f-prepared', 'f-from', 'f-until'];
      fields.forEach(id => { const el = document.getElementById(id); if (el) el.value = id.includes('time') || id.includes('from') || id.includes('until') || id.includes('prepared') ? '14:00' : ''; });
      document.querySelectorAll('.allergen-chip').forEach(c => c.classList.remove('selected'));
      STATE.hygieneChecked = false; STATE.photoUploaded = false;
      const wrap = document.getElementById('hygiene-check');
      const box = document.getElementById('check-box');
      const zone = document.getElementById('photo-upload-zone');
      const icon = document.getElementById('photo-icon');
      const text = document.getElementById('photo-text');
      if (wrap) wrap.classList.remove('checked');
      if (box) { box.textContent = ''; box.style.background = 'var(--surface)'; box.style.borderColor = 'var(--border)'; }
      if (zone) zone.classList.remove('uploaded');
      if (icon) icon.textContent = 'üì∑';
      if (text) text.innerHTML = 'Tap to upload a photo<br><span style="font-size:.68rem;opacity:.6">Required for safety verification</span>';
      ['err-type', 'err-qty', 'err-hygiene'].forEach(id => showErr(id, false));
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  BROADCAST
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function startBroadcast() {
      const d = window._lastDonation;
      const matching = document.getElementById('matching-state');
      const matched = document.getElementById('matched-state');
      const desc = document.getElementById('broadcast-desc');
      const foodIcon = document.getElementById('broadcast-food-icon');
      if (matching) matching.style.display = 'block';
      if (matched) matched.style.display = 'none';
      if (d) {
        if (desc) desc.textContent = `${d.qty} kg of ${d.type} is being broadcast to NGOs in Madhapur zone.`;
        if (foodIcon) foodIcon.textContent = foodEmojis[d.type] || 'üç±';
      }
      setTimeout(() => {
        if (matching) matching.style.display = 'none';
        if (matched) matched.style.display = 'block';
      }, 2400);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  SUCCESS SCREEN UPDATE
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function updateSuccessTime() {
      const d = window._lastDonation;
      if (!d) return;
      const now = new Date();
      const ts = `${String(now.getHours()).padStart(2, '0')}:${String(now.getMinutes()).padStart(2, '0')}:${String(now.getSeconds()).padStart(2, '0')} IST`;
      setText('suc-time', ts);
      setText('suc-id', '#' + d.id);
      setText('suc-meals', d.portions);
      setText('suc-kg', d.qty + 'kg');
      setText('suc-co2', Math.round(d.qty * 0.6) + 'kg');
      const desc = document.getElementById('success-desc');
      if (desc) desc.textContent = `${d.qty} kg of ${d.type} delivered to Akshaya Patra. You just fed ${d.portions} people!`;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  NGO ACCEPT DONATION
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function acceptDonation() {
      showToast('‚úÖ Volunteer assigned! Tracking live...');
      setTimeout(() => goTo('screen-tracking', 'screenIn'), 800);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  VOLUNTEER TASK TIMER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let taskTimerInterval;
    function startTaskTimer() {
      STATE.taskSeconds = 60;
      clearInterval(taskTimerInterval);
      taskTimerInterval = setInterval(() => {
        STATE.taskSeconds--;
        const el = document.getElementById('task-timer');
        const bar = document.getElementById('task-timer-bar');
        if (el) el.textContent = STATE.taskSeconds + 's';
        if (bar) bar.style.width = (STATE.taskSeconds / 60 * 100) + '%';
        if (STATE.taskSeconds <= 0) {
          clearInterval(taskTimerInterval);
          declineTask();
        }
      }, 1000);
    }

    function acceptVolTask() {
      clearInterval(taskTimerInterval);
      STATE.volXP += 120;
      setText('vol-xp', STATE.volXP.toLocaleString());
      setText('lb-my-xp', STATE.volXP.toLocaleString() + ' XP');
      setText('lb-my-pts', STATE.volXP);
      showToast('‚ö° Task accepted! +120 XP incoming');
      setTimeout(() => goTo('screen-vol-task', 'screenIn'), 500);
    }

    function declineTask() {
      clearInterval(taskTimerInterval);
      showToast('Task passed to next volunteer');
      const notif = document.getElementById('task-notif');
      if (notif) { notif.style.opacity = '0.3'; notif.style.pointerEvents = 'none'; }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  PDF REPORT DOWNLOAD
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function downloadPDFReport() {
      const { meals, kg, count, frs } = STATE.stats;
      const now = new Date();
      const dateStr = now.toLocaleDateString('en-IN', { year: 'numeric', month: 'long', day: 'numeric' });
      const timeStr = now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });

      const htmlContent = `<!DOCTYPE html>
<html><head><meta charset="UTF-8"><title>FAARZ Impact Report</title>
<style>
*{margin:0;padding:0;box-sizing:border-box}
body{font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;background:#fff;color:#1a1a1a;padding:40px}
.header{text-align:center;margin-bottom:40px;padding-bottom:20px;border-bottom:3px solid #65a30d}
.header h1{font-size:28px;color:#65a30d;margin-bottom:4px}
.header p{color:#666;font-size:14px}
.stats{display:grid;grid-template-columns:repeat(4,1fr);gap:16px;margin-bottom:32px}
.stat{text-align:center;padding:20px;background:#f8faf5;border:1px solid #e8ecf1;border-radius:12px}
.stat .val{font-size:32px;font-weight:800;color:#65a30d}
.stat .label{font-size:12px;color:#888;text-transform:uppercase;letter-spacing:1px;margin-top:4px}
.section{margin-bottom:24px}
.section h3{font-size:16px;color:#333;margin-bottom:12px;padding-bottom:6px;border-bottom:1px solid #eee}
table{width:100%;border-collapse:collapse;font-size:13px}
th{background:#f5f7fa;padding:10px;text-align:left;font-weight:600;border-bottom:2px solid #e8ecf1}
td{padding:10px;border-bottom:1px solid #f0f0f0}
.status{display:inline-block;padding:2px 8px;border-radius:6px;font-size:11px;font-weight:600}
.status-live{background:#e8f5e9;color:#2e7d32}
.status-delivered{background:#e3f2fd;color:#1565c0}
.status-picked{background:#fff3e0;color:#e65100}
.footer{text-align:center;margin-top:40px;padding-top:20px;border-top:2px solid #f0f0f0;color:#999;font-size:12px}
@media print{body{padding:20px}.header h1{font-size:24px}.stats{grid-template-columns:repeat(4,1fr)}}
</style></head><body>
<div class="header">
  <h1>üçΩÔ∏è FAARZ Impact Report</h1>
  <p>Surplus Food Redistribution Platform ¬∑ Spice Garden</p>
  <p style="margin-top:8px;font-size:12px;color:#999">Generated: ${dateStr} at ${timeStr}</p>
</div>
<div class="stats">
  <div class="stat"><div class="val">${meals}</div><div class="label">Meals Served</div></div>
  <div class="stat"><div class="val">${kg}</div><div class="label">KG Saved</div></div>
  <div class="stat"><div class="val">${count}</div><div class="label">Donations</div></div>
  <div class="stat"><div class="val">${frs}/100</div><div class="label">FRS Score</div></div>
</div>
<div class="section">
  <h3>üìã Donation History</h3>
  <table>
    <thead><tr><th>ID</th><th>Food Type</th><th>Qty</th><th>Portions</th><th>Time</th><th>Volunteer</th><th>Status</th></tr></thead>
    <tbody>
${STATE.donations.map(d => `      <tr><td>${d.id}</td><td>${d.type}</td><td>${d.qty} kg</td><td>~${d.portions}</td><td>${d.day} ${d.time}</td><td>${d.volunteer}</td><td><span class="status status-${d.status}">${d.status.toUpperCase()}</span></td></tr>`).join('\n')}
    </tbody>
  </table>
</div>
<div class="section">
  <h3>üåç Environmental Impact</h3>
  <table>
    <tbody>
      <tr><td><strong>Food Waste Diverted</strong></td><td>${kg} kg</td></tr>
      <tr><td><strong>CO‚ÇÇ Emissions Prevented</strong></td><td>~${Math.round(kg * 0.7)} kg</td></tr>
      <tr><td><strong>Water Saved</strong></td><td>~${Math.round(kg * 140)} litres</td></tr>
      <tr><td><strong>People Fed</strong></td><td>${meals} meals</td></tr>
    </tbody>
  </table>
</div>
<div class="footer">
  <p>FAARZ ‚Äî Surplus Food Redistribution ¬∑ Hyderabad, Madhapur Pilot Zone</p>
  <p style="margin-top:4px">Made with ‚ô• by Aamina ¬∑ faarz.app</p>
</div>
</body></html>`;

      const blob = new Blob([htmlContent], { type: 'text/html' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `FAARZ_Impact_Report_${now.toISOString().slice(0, 10)}.html`;
      document.body.appendChild(a);
      a.click();
      document.body.removeChild(a);
      URL.revokeObjectURL(url);
      showToast('üì• Report downloaded! Open in browser to print as PDF');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  SHARE IMPACT CARD
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function shareImpactCard() {
      const lastDonation = window._lastDonation || STATE.donations[STATE.donations.length - 1];
      const sucId = document.getElementById('suc-id')?.textContent || '#F-1001';
      const sucMeals = document.getElementById('suc-meals')?.textContent || '25';
      const sucKg = document.getElementById('suc-kg')?.textContent || '8kg';

      const shareText = `üçΩÔ∏è FAARZ Impact Card\n\n‚úÖ Food Delivered Successfully!\nüìã Donation: ${sucId}\nüçõ ${lastDonation?.type || 'Food'} ‚Äî ${lastDonation?.qty || 5} kg\nüë• ${sucMeals} meals served\nüåç ${sucKg} food waste diverted\n\nJoin the movement at faarz.app\n#FAARZ #ZeroFoodWaste #Hyderabad`;

      if (navigator.share) {
        navigator.share({
          title: 'FAARZ Impact Card',
          text: shareText,
        }).then(() => {
          showToast('üì§ Impact card shared!');
        }).catch(() => {
          copyToClipboard(shareText);
        });
      } else {
        copyToClipboard(shareText);
      }
    }

    function copyToClipboard(text) {
      if (navigator.clipboard) {
        navigator.clipboard.writeText(text).then(() => {
          showToast('üìã Impact card copied to clipboard!');
        }).catch(() => {
          fallbackCopy(text);
        });
      } else {
        fallbackCopy(text);
      }
    }

    function fallbackCopy(text) {
      const ta = document.createElement('textarea');
      ta.value = text;
      ta.style.position = 'fixed';
      ta.style.left = '-9999px';
      document.body.appendChild(ta);
      ta.select();
      try { document.execCommand('copy'); showToast('üìã Impact card copied to clipboard!'); }
      catch (e) { showToast('üì§ Share text ready!'); }
      document.body.removeChild(ta);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  OPEN NAVIGATION (Google Maps)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function openNavigation(lat, lng, name) {
      const url = `https://www.google.com/maps/dir/?api=1&destination=${lat},${lng}&destination_place_id=&travelmode=driving`;
      window.open(url, '_blank');
      showToast(`üó∫ Navigate to ${name}`);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  FILTER MODAL (NGO donations)
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function openFilterModal() {
      openModal(`
        <div style="margin-bottom:16px">
          <div style="font-family:var(--font-h);font-weight:700;font-size:1.1rem;margin-bottom:12px">Filter Donations</div>
          <div style="font-size:.8rem;color:var(--muted);margin-bottom:16px">Select which donations to show</div>
        </div>
        <div style="display:flex;flex-direction:column;gap:10px">
          <label style="display:flex;align-items:center;gap:10px;padding:12px;background:var(--surface);border:1px solid var(--border);border-radius:12px;cursor:pointer">
            <input type="checkbox" checked style="accent-color:var(--lime);width:18px;height:18px"> <span style="font-size:.85rem">üü¢ Expiring Soon (< 2h)</span>
          </label>
          <label style="display:flex;align-items:center;gap:10px;padding:12px;background:var(--surface);border:1px solid var(--border);border-radius:12px;cursor:pointer">
            <input type="checkbox" checked style="accent-color:var(--amber);width:18px;height:18px"> <span style="font-size:.85rem">üü° Available (2-4h)</span>
          </label>
          <label style="display:flex;align-items:center;gap:10px;padding:12px;background:var(--surface);border:1px solid var(--border);border-radius:12px;cursor:pointer">
            <input type="checkbox" style="accent-color:var(--cyan);width:18px;height:18px"> <span style="font-size:.85rem">üîµ Large Orders (> 20 portions)</span>
          </label>
          <label style="display:flex;align-items:center;gap:10px;padding:12px;background:var(--surface);border:1px solid var(--border);border-radius:12px;cursor:pointer">
            <input type="checkbox" checked style="accent-color:var(--cyan);width:18px;height:18px"> <span style="font-size:.85rem">üìç Nearby (< 3km)</span>
          </label>
        </div>
        <button class="btn btn-primary" style="margin-top:16px;width:100%" onclick="closeModal();showToast('‚úÖ Filters applied!')">Apply Filters</button>
      `);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CHAT MODAL
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function openChatModal() {
      openModal(`
        <div style="margin-bottom:12px">
          <div style="font-family:var(--font-h);font-weight:700;font-size:1.1rem;margin-bottom:4px">üí¨ Chat with Donor</div>
          <div style="font-size:.75rem;color:var(--muted);font-family:var(--font-m)">Spice Garden ¬∑ Online</div>
        </div>
        <div style="background:var(--surface);border-radius:14px;padding:12px;height:180px;overflow-y:auto;margin-bottom:12px;display:flex;flex-direction:column;gap:8px" id="chat-messages">
          <div style="align-self:flex-start;background:var(--panel);padding:8px 12px;border-radius:12px 12px 12px 4px;font-size:.82rem;max-width:80%">
            Hi! The biryani is packed and ready for pickup üçõ
            <div style="font-size:.6rem;color:var(--muted);margin-top:4px;font-family:var(--font-m)">2:48 PM</div>
          </div>
          <div style="align-self:flex-end;background:rgba(184,249,40,0.12);border:1px solid rgba(184,249,40,0.2);padding:8px 12px;border-radius:12px 12px 4px 12px;font-size:.82rem;max-width:80%">
            Great! Volunteer is on the way, ETA 5 min
            <div style="font-size:.6rem;color:var(--muted);margin-top:4px;font-family:var(--font-m)">2:49 PM</div>
          </div>
          <div style="align-self:flex-start;background:var(--panel);padding:8px 12px;border-radius:12px 12px 12px 4px;font-size:.82rem;max-width:80%">
            Perfect, we'll keep it warm! üëç
            <div style="font-size:.6rem;color:var(--muted);margin-top:4px;font-family:var(--font-m)">2:49 PM</div>
          </div>
        </div>
        <div style="display:flex;gap:8px">
          <input type="text" class="input-field" placeholder="Type a message..." id="chat-input" style="flex:1" onkeydown="if(event.key==='Enter')sendChatMsg()">
          <button class="btn btn-primary btn-sm" onclick="sendChatMsg()" style="padding:8px 14px">Send</button>
        </div>
      `);
    }

    function sendChatMsg() {
      const input = document.getElementById('chat-input');
      const container = document.getElementById('chat-messages');
      if (!input || !container || !input.value.trim()) return;
      const msg = input.value.trim();
      const now = new Date();
      const timeStr = now.toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
      container.innerHTML += `<div style="align-self:flex-end;background:rgba(184,249,40,0.12);border:1px solid rgba(184,249,40,0.2);padding:8px 12px;border-radius:12px 12px 4px 12px;font-size:.82rem;max-width:80%">${msg}<div style="font-size:.6rem;color:var(--muted);margin-top:4px;font-family:var(--font-m)">${timeStr}</div></div>`;
      input.value = '';
      container.scrollTop = container.scrollHeight;
      // Auto-reply after 1.5s
      setTimeout(() => {
        const replies = ['Got it, thanks! üôè', 'Will check and confirm üëç', 'On it! ‚úÖ', 'Receipt ready üìã'];
        const reply = replies[Math.floor(Math.random() * replies.length)];
        const replyTime = new Date().toLocaleTimeString('en-IN', { hour: '2-digit', minute: '2-digit' });
        container.innerHTML += `<div style="align-self:flex-start;background:var(--panel);padding:8px 12px;border-radius:12px 12px 12px 4px;font-size:.82rem;max-width:80%">${reply}<div style="font-size:.6rem;color:var(--muted);margin-top:4px;font-family:var(--font-m)">${replyTime}</div></div>`;
        container.scrollTop = container.scrollHeight;
      }, 1500);
    }

    // Start timer when volunteer screen is visited
    document.getElementById('screen-volunteer').addEventListener('animationstart', () => {
      if (STATE.taskActive) startTaskTimer();
    });

    function fakeQrScan(btn) {
      if (!btn) return;
      btn.textContent = '‚è≥ Scanning...'; btn.disabled = true;
      setTimeout(() => {
        btn.textContent = '‚úÖ Verified';
        btn.style.background = 'rgba(6,214,160,0.12)';
        btn.style.color = 'var(--cyan)';
        btn.style.borderColor = 'rgba(6,214,160,0.25)';
        showToast('üì∑ QR scanned & verified!');
        btn.disabled = false;
      }, 1500);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  LIVE MAP ‚Äî Leaflet + Geolocation + Overpass API
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let ngoMarkers = [];
    // Fallback: Madhapur, Hyderabad
    const FALLBACK_LAT = 17.4474, FALLBACK_LNG = 78.3762;

    function initNgoMap() {
      if (ngoMap) { ngoMap.invalidateSize(); return; }

      const loadEl = document.getElementById('map-loading');
      const labelEl = document.getElementById('map-overlay-label');

      // Dark tile layer (CartoDB Dark Matter ‚Äî no API key needed)
      function buildMap(lat, lng, isReal) {
        if (loadEl) loadEl.style.display = 'none';

        ngoMap = L.map('live-map', {
          zoomControl: false,
          attributionControl: false,
          dragging: true,
          scrollWheelZoom: false,
          doubleClickZoom: true
        }).setView([lat, lng], 14);

        ngoTileLayer = L.tileLayer(getTileUrl(), TILE_OPTS).addTo(ngoMap);

        // "You" marker
        const youIcon = L.divIcon({
          className: '',
          html: `<div style="width:18px;height:18px;background:#06d6a0;border-radius:50%;border:3px solid rgba(6,214,160,0.35);box-shadow:0 0 0 6px rgba(6,214,160,0.15),0 0 20px rgba(6,214,160,0.5)"></div>`,
          iconSize: [18, 18], iconAnchor: [9, 9]
        });
        L.marker([lat, lng], { icon: youIcon, zIndexOffset: 1000 })
          .addTo(ngoMap)
          .bindPopup(`<div class="pop-name">üìç You Are Here</div><div class="pop-type">${isReal ? 'GPS Location' : 'Default ¬∑ Madhapur'}</div>`, { className: 'faarz-popup' });

        if (labelEl) {
          const city = isReal ? 'Your Location ¬∑ Live' : 'Madhapur Zone ¬∑ Live';
          labelEl.textContent = 'üìç ' + city;
        }

        // Fetch nearby NGOs/shelters via Overpass API
        fetchNearbyNGOs(lat, lng);
      }

      // Try real geolocation first
      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          pos => buildMap(pos.coords.latitude, pos.coords.longitude, true),
          () => buildMap(FALLBACK_LAT, FALLBACK_LNG, false),
          { timeout: 6000, maximumAge: 60000 }
        );
      } else {
        buildMap(FALLBACK_LAT, FALLBACK_LNG, false);
      }
    }

    async function fetchNearbyNGOs(lat, lng) {
      // Overpass API query ‚Äî finds food banks, shelters, social facilities, charities
      const query = `
    [out:json][timeout:20];
    (
      node["amenity"="social_facility"](around:5000,${lat},${lng});
      node["amenity"="food_bank"](around:5000,${lat},${lng});
      node["social_facility"~"food_bank|shelter|soup_kitchen|outreach|refugee"](around:5000,${lat},${lng});
      node["charity"](around:5000,${lat},${lng});
      node["ngo"](around:5000,${lat},${lng});
      node["office"="ngo"](around:5000,${lat},${lng});
      node["office"="charity"](around:5000,${lat},${lng});
      way["amenity"="social_facility"](around:5000,${lat},${lng});
      way["office"~"ngo|charity"](around:5000,${lat},${lng});
    );
    out center 40;
  `;

      const ngoIcon = L.divIcon({
        className: '',
        html: `<div style="width:14px;height:14px;background:#b8f928;border-radius:50%;border:2px solid rgba(184,249,40,0.4);box-shadow:0 0 12px rgba(184,249,40,0.6)"></div>`,
        iconSize: [14, 14], iconAnchor: [7, 7]
      });
      const pickupIcon = L.divIcon({
        className: '',
        html: `<div style="width:12px;height:12px;background:#ff9f0a;border-radius:50%;border:2px solid rgba(255,159,10,0.4);box-shadow:0 0 10px rgba(255,159,10,0.5)"></div>`,
        iconSize: [12, 12], iconAnchor: [6, 6]
      });

      try {
        const resp = await fetch('https://overpass-api.de/api/interpreter', {
          method: 'POST',
          body: 'data=' + encodeURIComponent(query)
        });
        if (!resp.ok) throw new Error('Overpass error');
        const data = await resp.json();

        let found = 0;
        data.elements.forEach(el => {
          const elLat = el.lat || el.center?.lat;
          const elLng = el.lon || el.center?.lon;
          if (!elLat || !elLng || !ngoMap) return;

          const name = el.tags?.name || el.tags?.['name:en'] || el.tags?.['operator'] || 'Unnamed Shelter';
          const type = el.tags?.['social_facility'] || el.tags?.['amenity'] || el.tags?.['office'] || 'social_facility';
          const typeLabel = type.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
          const dist = calcDist(lat, lng, elLat, elLng);
          if (dist > 6) return; // skip very far results

          const isActive = Math.random() > 0.5; // simulate some as having active pickups
          const icon = isActive ? pickupIcon : ngoIcon;

          const marker = L.marker([elLat, elLng], { icon })
            .addTo(ngoMap)
            .bindPopup(`
          <div class="pop-name">${escHtml(name)}</div>
          <div class="pop-type">${typeLabel}</div>
          <div class="pop-dist">üìç ${dist.toFixed(1)} km away${isActive ? ' ¬∑ üü° Pickup Active' : ''}</div>
          <div class="pop-accept" onclick="ngoAcceptFromMap('${escHtml(name)}')">‚úÖ Accept Donation Here</div>
        `, { className: 'faarz-popup', maxWidth: 220 });
          ngoMarkers.push(marker);
          found++;
        });

        // If Overpass returns nothing (rural / no OSM data), add curated Hyderabad fallbacks
        if (found === 0) addFallbackMarkers(lat, lng, ngoIcon);

        // Update live count badge
        const badge = document.getElementById('ngo-new-badge');
        if (badge && found > 0) badge.textContent = `üîî ${found} Nearby`;

        // Refresh label
        const labelEl = document.getElementById('map-overlay-label');
        if (labelEl) labelEl.textContent = `üìç ${found > 0 ? found + ' NGOs found' : 'Hyderabad Zone'} ¬∑ Live`;

      } catch (e) {
        // Network/CORS fallback ‚Äî add known Hyderabad NGOs
        addFallbackMarkers(lat, lng, ngoIcon);
        const labelEl = document.getElementById('map-overlay-label');
        if (labelEl) labelEl.textContent = 'üìç Hyderabad Zone ¬∑ Offline Mode';
      }
    }

    // Curated Hyderabad NGOs as fallback when Overpass has no data / offline
    function addFallbackMarkers(userLat, userLng, icon) {
      const knownNGOs = [
        { name: 'Akshaya Patra Foundation', lat: 17.4417, lng: 78.3808, type: 'Food Bank' },
        { name: 'Feeding India ‚Äî Hyderabad', lat: 17.4523, lng: 78.3654, type: 'Food Distribution' },
        { name: 'Robin Hood Army HYD', lat: 17.4391, lng: 78.3902, type: 'Surplus Food NGO' },
        { name: 'Smile Foundation Shelter', lat: 17.4612, lng: 78.3701, type: 'Shelter & Meals' },
        { name: 'CRY Hyderabad', lat: 17.4280, lng: 78.3580, type: 'Social Facility' },
        { name: 'Hyderabad Food Bank', lat: 17.4530, lng: 78.4010, type: 'Food Bank' },
        { name: 'Nanhi Dunya Foundation', lat: 17.4350, lng: 78.3750, type: 'Food & Shelter' },
        { name: 'SEEDS India ‚Äî HITEC Chapter', lat: 17.4490, lng: 78.3900, type: 'Disaster Relief NGO' },
      ];
      if (!ngoMap) return;
      knownNGOs.forEach(n => {
        const dist = calcDist(userLat, userLng, n.lat, n.lng);
        L.marker([n.lat, n.lng], { icon })
          .addTo(ngoMap)
          .bindPopup(`
        <div class="pop-name">${n.name}</div>
        <div class="pop-type">${n.type}</div>
        <div class="pop-dist">üìç ${dist.toFixed(1)} km away</div>
        <div class="pop-accept" onclick="ngoAcceptFromMap('${n.name}')">‚úÖ Accept Donation Here</div>
      `, { className: 'faarz-popup', maxWidth: 220 });
      });
      const badge = document.getElementById('ngo-new-badge');
      if (badge) badge.textContent = `üîî ${knownNGOs.length} Nearby`;
    }

    function ngoAcceptFromMap(name) {
      if (ngoMap) ngoMap.closePopup();
      showToast(`‚úÖ ${name} accepted donation!`);
      setTimeout(() => goTo('screen-ngo-detail', 'screenIn'), 600);
    }

    function calcDist(lat1, lng1, lat2, lng2) {
      const R = 6371, dLat = (lat2 - lat1) * Math.PI / 180, dLng = (lng2 - lng1) * Math.PI / 180;
      const a = Math.sin(dLat / 2) ** 2 + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLng / 2) ** 2;
      return R * 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
    }
    function escHtml(s) { return s.replace(/[&<>"']/g, c => ({ '&': '&amp;', '<': '&lt;', '>': '&gt;', '"': '&quot;', "'": '&#39;' }[c])); }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  TRACKING MAP
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let trackRAF;
    let etaSeconds = 18 * 60;
    let etaInterval;
    // Tracking map variables
    let trackingMap = null;
    let trackingTileLayer = null;
    let riderMarker = null;
    let routeLine = null;
    let completedLine = null;
    let riderProgress = 0.3; // 0 = pickup, 1 = drop

    // Route points: Spice Garden (Madhapur) ‚Üí Akshaya Patra (Kondapur)
    const PICKUP_POS = [17.4474, 78.3762];  // Spice Garden
    const DROP_POS = [17.4581, 78.3548];  // Akshaya Patra
    // Create a realistic curved route with intermediate waypoints
    const ROUTE_POINTS = [
      [17.4474, 78.3762],
      [17.4480, 78.3740],
      [17.4492, 78.3718],
      [17.4505, 78.3695],
      [17.4518, 78.3672],
      [17.4525, 78.3658],
      [17.4535, 78.3640],
      [17.4545, 78.3620],
      [17.4555, 78.3598],
      [17.4565, 78.3575],
      [17.4575, 78.3558],
      [17.4581, 78.3548]
    ];

    function getPointOnRoute(progress) {
      const totalPoints = ROUTE_POINTS.length - 1;
      const exactIdx = progress * totalPoints;
      const idx = Math.floor(exactIdx);
      const frac = exactIdx - idx;
      if (idx >= totalPoints) return ROUTE_POINTS[totalPoints];
      const p1 = ROUTE_POINTS[idx];
      const p2 = ROUTE_POINTS[idx + 1];
      return [
        p1[0] + (p2[0] - p1[0]) * frac,
        p1[1] + (p2[1] - p1[1]) * frac
      ];
    }

    function initTrackingMap() {
      const container = document.getElementById('tracking-leaflet-map');
      if (!container) return;

      // Reset if map already exists
      if (trackingMap) {
        trackingMap.remove();
        trackingMap = null;
      }

      riderProgress = 0.3;
      const etaEl = document.getElementById('eta-countdown');
      etaSeconds = 18 * 60; clearInterval(etaInterval);
      etaInterval = setInterval(() => {
        etaSeconds = Math.max(0, etaSeconds - 1);
        const m = Math.floor(etaSeconds / 60);
        if (etaEl) etaEl.textContent = m;
        const miniEta = document.getElementById('rider-eta-mini');
        if (miniEta) miniEta.textContent = m;
      }, 1000);

      // Create map centered between pickup and drop
      const centerLat = (PICKUP_POS[0] + DROP_POS[0]) / 2;
      const centerLng = (PICKUP_POS[1] + DROP_POS[1]) / 2;
      trackingMap = L.map('tracking-leaflet-map', {
        zoomControl: false,
        attributionControl: false,
        dragging: true,
        scrollWheelZoom: false,
        doubleClickZoom: true
      }).setView([centerLat, centerLng], 14);

      trackingTileLayer = L.tileLayer(getTileUrl(), TILE_OPTS).addTo(trackingMap);

      // Draw the full route as dashed line (remaining)
      routeLine = L.polyline(ROUTE_POINTS, {
        color: getTheme() === 'light' ? '#65a30d' : '#b8f928',
        weight: 4,
        opacity: 0.25,
        dashArray: '8, 10',
        lineCap: 'round'
      }).addTo(trackingMap);

      // Draw the completed portion
      const completedIdx = Math.floor(riderProgress * (ROUTE_POINTS.length - 1)) + 1;
      const completedPoints = ROUTE_POINTS.slice(0, completedIdx + 1);
      completedLine = L.polyline(completedPoints, {
        color: getTheme() === 'light' ? '#65a30d' : '#b8f928',
        weight: 5,
        opacity: 0.8,
        lineCap: 'round'
      }).addTo(trackingMap);

      // Pickup marker (restaurant - orange)
      const pickupIcon = L.divIcon({
        className: '',
        html: `<div style="position:relative">
          <div style="width:40px;height:40px;border-radius:12px;background:rgba(255,159,10,0.15);border:2px solid rgba(255,159,10,0.4);display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 4px 12px rgba(255,159,10,0.3)">üçΩÔ∏è</div>
          <div style="position:absolute;top:-22px;left:50%;transform:translateX(-50%);white-space:nowrap;font-family:'DM Mono',monospace;font-size:9px;letter-spacing:0.08em;color:#ff9f0a;background:rgba(13,17,23,0.85);padding:2px 8px;border-radius:6px;border:1px solid rgba(255,159,10,0.3)">PICKUP</div>
        </div>`,
        iconSize: [40, 40], iconAnchor: [20, 20]
      });
      L.marker(PICKUP_POS, { icon: pickupIcon, zIndexOffset: 500 }).addTo(trackingMap);

      // Drop marker (NGO - green)
      const dropIcon = L.divIcon({
        className: '',
        html: `<div style="position:relative">
          <div style="width:40px;height:40px;border-radius:12px;background:rgba(6,214,160,0.15);border:2px solid rgba(6,214,160,0.4);display:flex;align-items:center;justify-content:center;font-size:18px;box-shadow:0 4px 12px rgba(6,214,160,0.3);animation:glowCyan 2s infinite">üè†</div>
          <div style="position:absolute;top:-22px;left:50%;transform:translateX(-50%);white-space:nowrap;font-family:'DM Mono',monospace;font-size:9px;letter-spacing:0.08em;color:#06d6a0;background:rgba(13,17,23,0.85);padding:2px 8px;border-radius:6px;border:1px solid rgba(6,214,160,0.3)">NGO DROP</div>
        </div>`,
        iconSize: [40, 40], iconAnchor: [20, 20]
      });
      L.marker(DROP_POS, { icon: dropIcon, zIndexOffset: 500 }).addTo(trackingMap);

      // Rider marker (bike - animated)
      const riderPos = getPointOnRoute(riderProgress);
      const bikeIcon = L.divIcon({
        className: 'rider-marker',
        html: `<div style="position:relative">
          <div style="width:44px;height:44px;border-radius:50%;background:rgba(184,249,40,0.15);border:2px solid rgba(184,249,40,0.5);display:flex;align-items:center;justify-content:center;font-size:22px;box-shadow:0 0 0 6px rgba(184,249,40,0.1),0 0 20px rgba(184,249,40,0.3);animation:livePulse 2s infinite;transition:transform 0.3s">üõµ</div>
          <div style="position:absolute;bottom:-18px;left:50%;transform:translateX(-50%);white-space:nowrap;font-family:'Syne',sans-serif;font-size:8px;font-weight:700;letter-spacing:0.05em;color:var(--lime);background:var(--base);padding:2px 8px;border-radius:6px;border:1px solid rgba(184,249,40,0.3);box-shadow:0 2px 8px rgba(0,0,0,0.3)">RAZA</div>
        </div>`,
        iconSize: [44, 44], iconAnchor: [22, 22]
      });
      riderMarker = L.marker(riderPos, { icon: bikeIcon, zIndexOffset: 1000 }).addTo(trackingMap);

      // Fit map to show the full route
      trackingMap.fitBounds(L.latLngBounds(ROUTE_POINTS).pad(0.15));

      // Start slow auto-movement of rider
      startRiderAnimation();
    }

    let riderAnimInterval = null;
    function startRiderAnimation() {
      clearInterval(riderAnimInterval);
      riderAnimInterval = setInterval(() => {
        if (riderProgress >= 1) { clearInterval(riderAnimInterval); return; }
        riderProgress = Math.min(1, riderProgress + 0.002);
        updateRiderPosition();
      }, 100);
    }

    function updateRiderPosition() {
      if (!riderMarker || !trackingMap) return;
      const pos = getPointOnRoute(riderProgress);
      riderMarker.setLatLng(pos);

      // Update completed line
      if (completedLine) {
        const completedIdx = Math.floor(riderProgress * (ROUTE_POINTS.length - 1));
        const frac = (riderProgress * (ROUTE_POINTS.length - 1)) - completedIdx;
        const points = ROUTE_POINTS.slice(0, completedIdx + 1);
        if (completedIdx < ROUTE_POINTS.length - 1) {
          const p1 = ROUTE_POINTS[completedIdx];
          const p2 = ROUTE_POINTS[completedIdx + 1];
          points.push([p1[0] + (p2[0] - p1[0]) * frac, p1[1] + (p2[1] - p1[1]) * frac]);
        }
        completedLine.setLatLngs(points);
      }

      // Update distance text
      const remaining = (1 - riderProgress) * 2.4; // ~2.4km total
      const distEl = document.getElementById('rider-distance-text');
      if (distEl) distEl.textContent = `${remaining.toFixed(1)} km remaining`;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  DELIVERY SIMULATION
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function simulateDelivery() {
      clearInterval(riderAnimInterval);

      const steps = [{ id: 'p3', icon: '‚úÖ', label: 'Picked Up', sub: 'QR scanned at restaurant ¬∑ ' + nowTime() },
      { id: 'p4', icon: '‚úÖ', label: 'En Route to NGO', sub: 'Heading to Akshaya Patra' },
      { id: 'p5', icon: '‚úÖ', label: 'Delivered ‚úÖ', sub: 'QR scanned at NGO ¬∑ ' + nowTime(), final: true }];

      let i = 0;
      // Animate rider fast to destination
      let fastProgress = riderProgress;
      const fastAnimate = () => {
        if (fastProgress >= 1) return;
        fastProgress = Math.min(1, fastProgress + 0.015);
        riderProgress = fastProgress;
        updateRiderPosition();
        if (fastProgress < 1) requestAnimationFrame(fastAnimate);
      };
      fastAnimate();

      // Update the badge
      const badge = document.getElementById('tracking-badge');

      const next = () => {
        const step = steps[i]; if (!step) return;
        const el = document.getElementById(step.id);
        if (el) {
          el.classList.remove('active'); el.classList.add('done');
          el.querySelector('.p-icon').textContent = step.icon;
          el.querySelector('.p-label').textContent = step.label;
          el.querySelector('.p-sub').textContent = step.sub;
        }
        const nextEl = document.getElementById(steps[i + 1]?.id);
        if (nextEl && !step.final) nextEl.classList.add('active');
        if (step.final) {
          if (badge) { badge.textContent = 'DELIVERED'; badge.style.background = 'rgba(184,249,40,0.15)'; badge.style.color = 'var(--lime)'; }
          clearInterval(etaInterval);
          if (STATE.donations.length > 0) {
            const liveIdx = STATE.donations.findIndex(d => d.status === 'live');
            if (liveIdx >= 0) STATE.donations[liveIdx].status = 'delivered';
          }
          // Pan map to drop location
          if (trackingMap) trackingMap.flyTo(DROP_POS, 16, { duration: 1 });
          setTimeout(() => goTo('screen-success', 'screenIn'), 1800);
          return;
        }
        i++;
        setTimeout(next, 1000);
      };
      // Update badge to show acceleration
      if (badge) { badge.textContent = 'ARRIVING'; badge.style.background = 'rgba(255,159,10,0.15)'; badge.style.color = 'var(--amber)'; }
      setTimeout(next, 500);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  CONFETTI
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function launchConfetti() {
      const container = document.getElementById('confetti-container');
      if (!container) return;
      container.innerHTML = '';
      const colors = ['#b8f928', '#ff9f0a', '#ff3b5c', '#06d6a0', '#4a9eff', '#fff'];
      const style = document.createElement('style');
      style.textContent = `@keyframes confettiFall{to{transform:translateY(900px) rotate(720deg);opacity:0}}`;
      document.head.appendChild(style);
      for (let i = 0; i < 60; i++) {
        const el = document.createElement('div');
        const c = colors[Math.floor(Math.random() * colors.length)];
        const s = Math.random() * 8 + 4;
        el.style.cssText = `position:absolute;width:${s}px;height:${s}px;background:${c};border-radius:${Math.random() > .5 ? '50%' : '2px'};left:${Math.random() * 100}%;top:-10px;opacity:1;animation:confettiFall ${Math.random() * 2 + 1.5}s ${Math.random() * .8}s cubic-bezier(0.25,0.46,0.45,0.94) forwards`;
        container.appendChild(el);
      }
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  DETAIL COUNTDOWN TIMER
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    let detailTimerInterval;
    function startDetailTimer() {
      let s = 6452;
      clearInterval(detailTimerInterval);
      detailTimerInterval = setInterval(() => {
        s = Math.max(0, s - 1);
        const h = Math.floor(s / 3600), m = Math.floor((s % 3600) / 60), sec = s % 60;
        const el = document.getElementById('detail-timer');
        if (el) el.textContent = `${h}:${String(m).padStart(2, '0')}:${String(sec).padStart(2, '0')}`;
      }, 1000);
    }
    startDetailTimer();

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  HEARTBEAT
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    setInterval(() => {
      const h = document.getElementById('heart');
      if (h) { h.style.transform = 'scale(1.4)'; setTimeout(() => h.style.transform = 'scale(1)', 200); }
    }, 1400);

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  UTILS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function setText(id, val) {
      const el = document.getElementById(id);
      if (el) el.textContent = val;
    }
    function nowTime() {
      const n = new Date();
      return `${String(n.getHours()).padStart(2, '0')}:${String(n.getMinutes()).padStart(2, '0')}`;
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  NAV HELPERS
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function setNgoNav(tab, el) {
      ['ngo-nav-home', 'ngo-nav-map', 'ngo-nav-hist'].forEach(id => {
        const n = document.getElementById(id); if (n) n.classList.remove('active');
      });
      if (el) el.classList.add('active');
    }
    function setVolNav(tab, el) {
      ['vol-nav-home', 'vol-nav-tasks', 'vol-nav-ranks'].forEach(id => {
        const n = document.getElementById(id); if (n) n.classList.remove('active');
      });
      if (el) el.classList.add('active');
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  FULL MAP SCREEN
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function initFullMap() {
      if (fullMap) { fullMap.invalidateSize(); return; }
      const loadEl = document.getElementById('full-map-loading');
      const labelEl = document.getElementById('full-map-label');
      const badge = document.getElementById('full-map-badge');

      function buildFullMap(lat, lng, isReal) {
        if (loadEl) loadEl.style.display = 'none';
        fullMap = L.map('full-map', {
          zoomControl: true, attributionControl: false,
          dragging: true, scrollWheelZoom: true, doubleClickZoom: true
        }).setView([lat, lng], 15);

        // Restore zoom controls but style them
        fullMap.zoomControl.setPosition('bottomright');

        fullTileLayer = L.tileLayer(getTileUrl(), TILE_OPTS).addTo(fullMap);

        const youIcon = L.divIcon({
          className: '',
          html: `<div style="width:20px;height:20px;background:#06d6a0;border-radius:50%;border:3px solid rgba(6,214,160,0.4);box-shadow:0 0 0 8px rgba(6,214,160,0.15),0 0 24px rgba(6,214,160,0.6)"></div>`,
          iconSize: [20, 20], iconAnchor: [10, 10]
        });
        L.marker([lat, lng], { icon: youIcon, zIndexOffset: 1000 }).addTo(fullMap)
          .bindPopup(`<div class="pop-name">üìç You Are Here</div><div class="pop-type">${isReal ? 'GPS Location' : 'Default ¬∑ Madhapur'}</div>`, { className: 'faarz-popup' });

        if (labelEl) labelEl.textContent = `üìç ${isReal ? 'Your Location' : 'Madhapur Zone'} ¬∑ Live`;
        fetchNearbyNGOsForMap(lat, lng, fullMap, badge, 'nearby-ngo-list');
      }

      if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
          p => buildFullMap(p.coords.latitude, p.coords.longitude, true),
          () => buildFullMap(FALLBACK_LAT, FALLBACK_LNG, false),
          { timeout: 6000, maximumAge: 60000 }
        );
      } else { buildFullMap(FALLBACK_LAT, FALLBACK_LNG, false); }
    }

    async function fetchNearbyNGOsForMap(lat, lng, mapRef, badgeEl, listId) {
      const query = `[out:json][timeout:20];(node["amenity"="social_facility"](around:5000,${lat},${lng});node["amenity"="food_bank"](around:5000,${lat},${lng});node["office"~"ngo|charity"](around:5000,${lat},${lng});way["amenity"="social_facility"](around:5000,${lat},${lng}););out center 40;`;
      const ngoIcon = L.divIcon({ className: '', html: `<div style="width:15px;height:15px;background:#b8f928;border-radius:50%;border:2px solid rgba(184,249,40,0.5);box-shadow:0 0 14px rgba(184,249,40,0.7)"></div>`, iconSize: [15, 15], iconAnchor: [7, 7] });
      const pickupIcon = L.divIcon({ className: '', html: `<div style="width:13px;height:13px;background:#ff9f0a;border-radius:50%;border:2px solid rgba(255,159,10,0.5);box-shadow:0 0 12px rgba(255,159,10,0.6)"></div>`, iconSize: [13, 13], iconAnchor: [6, 6] });
      const listEl = document.getElementById(listId);
      const foundNGOs = [];

      try {
        const resp = await fetch('https://overpass-api.de/api/interpreter', { method: 'POST', body: 'data=' + encodeURIComponent(query) });
        if (!resp.ok) throw new Error('Overpass error');
        const data = await resp.json();
        data.elements.forEach(el => {
          const elLat = el.lat || el.center?.lat, elLng = el.lon || el.center?.lon;
          if (!elLat || !elLng || !mapRef) return;
          const name = el.tags?.name || el.tags?.['name:en'] || el.tags?.operator || 'Unnamed Shelter';
          const type = el.tags?.social_facility || el.tags?.amenity || el.tags?.office || 'social_facility';
          const typeLabel = type.replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
          const dist = calcDist(lat, lng, elLat, elLng);
          if (dist > 6) return;
          const isActive = Math.random() > 0.5;
          L.marker([elLat, elLng], { icon: isActive ? pickupIcon : ngoIcon })
            .addTo(mapRef)
            .bindPopup(`<div class="pop-name">${escHtml(name)}</div><div class="pop-type">${typeLabel}</div><div class="pop-dist">üìç ${dist.toFixed(1)} km${isActive ? ' ¬∑ üü° Active' : ''}</div><div class="pop-accept" onclick="ngoAcceptFromMap('${escHtml(name)}')">‚úÖ Accept Donation</div>`, { className: 'faarz-popup', maxWidth: 220 });
          foundNGOs.push({ name, typeLabel, dist, isActive });
        });
        if (foundNGOs.length === 0) addFallbackMarkersTo(lat, lng, ngoIcon, mapRef, foundNGOs);
      } catch (e) {
        addFallbackMarkersTo(lat, lng, ngoIcon, mapRef, foundNGOs);
      }

      if (badgeEl) { badgeEl.textContent = `${foundNGOs.length || 8} NGOs Found`; badgeEl.style.background = 'rgba(6,214,160,.1)'; badgeEl.style.color = 'var(--cyan)'; badgeEl.style.borderColor = 'rgba(6,214,160,.2)'; }
      const badge2 = document.getElementById('ngo-new-badge');
      if (badge2) badge2.textContent = `üîî ${foundNGOs.length || 8} Nearby`;

      if (listEl) {
        const display = foundNGOs.length > 0 ? foundNGOs : getFallbackNGOList(lat, lng);
        listEl.innerHTML = display.sort((a, b) => a.dist - b.dist).map(n => `
      <div onclick="ngoAcceptFromMap('${escHtml(n.name)}')" style="display:flex;align-items:center;gap:10px;padding:10px 12px;background:var(--surface);border:1px solid var(--border);border-radius:10px;cursor:pointer;transition:border-color .2s" onmouseover="this.style.borderColor='rgba(6,214,160,.3)'" onmouseout="this.style.borderColor='rgba(255,255,255,.07)'">
        <div style="width:32px;height:32px;border-radius:8px;background:rgba(6,214,160,.1);border:1px solid rgba(6,214,160,.2);display:flex;align-items:center;justify-content:center;font-size:15px;flex-shrink:0">${n.isActive ? 'üü°' : 'üè†'}</div>
        <div style="flex:1;min-width:0">
          <div style="font-weight:600;font-size:.82rem;white-space:nowrap;overflow:hidden;text-overflow:ellipsis">${escHtml(n.name)}</div>
          <div style="font-size:.68rem;color:var(--muted)">${n.typeLabel} ¬∑ ${n.dist.toFixed(1)} km</div>
        </div>
        <span class="chip ${n.isActive ? 'chip-amber' : 'chip-cyan'}" style="font-size:.55rem;flex-shrink:0">${n.isActive ? 'ACTIVE' : 'OPEN'}</span>
      </div>`).join('');
      }
    }

    function addFallbackMarkersTo(userLat, userLng, icon, mapRef, arr) {
      const list = getFallbackNGOList(userLat, userLng);
      list.forEach(n => {
        L.marker([n.lat, n.lng], { icon }).addTo(mapRef)
          .bindPopup(`<div class="pop-name">${n.name}</div><div class="pop-type">${n.typeLabel}</div><div class="pop-dist">üìç ${n.dist.toFixed(1)} km</div><div class="pop-accept" onclick="ngoAcceptFromMap('${escHtml(n.name)}')">‚úÖ Accept Donation</div>`, { className: 'faarz-popup', maxWidth: 220 });
        arr.push(n);
      });
    }

    function getFallbackNGOList(userLat, userLng) {
      return [
        { name: 'Akshaya Patra Foundation', lat: 17.4417, lng: 78.3808, typeLabel: 'Food Bank', isActive: true },
        { name: 'Feeding India ‚Äî Hyderabad', lat: 17.4523, lng: 78.3654, typeLabel: 'Food Distribution', isActive: false },
        { name: 'Robin Hood Army HYD', lat: 17.4391, lng: 78.3902, typeLabel: 'Surplus Food NGO', isActive: true },
        { name: 'Smile Foundation Shelter', lat: 17.4612, lng: 78.3701, typeLabel: 'Shelter & Meals', isActive: false },
        { name: 'Hyderabad Food Bank', lat: 17.4530, lng: 78.4010, typeLabel: 'Food Bank', isActive: true },
        { name: 'Nanhi Dunya Foundation', lat: 17.4350, lng: 78.3750, typeLabel: 'Food & Shelter', isActive: false },
        { name: 'SEEDS India ‚Äî HITEC', lat: 17.4490, lng: 78.3900, typeLabel: 'Relief NGO', isActive: false },
        { name: 'CRY Hyderabad', lat: 17.4280, lng: 78.3580, typeLabel: 'Social Facility', isActive: false },
      ].map(n => ({ ...n, dist: calcDist(userLat, userLng, n.lat, n.lng) }));
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  NGO HISTORY
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderNgoHistory(filter) {
      const f = filter || 'all';
      const list = document.getElementById('ngo-history-list');
      const badge = document.getElementById('hist-total-badge');
      if (!list) return;
      const items = f === 'all' ? STATE.donations : STATE.donations.filter(d => d.status === f);
      if (badge) badge.textContent = `${items.length} received`;
      setText('hist-total-kg', STATE.stats.kg);
      setText('hist-total-meals', STATE.stats.meals);
      const uniqueDonors = [...new Set(STATE.donations.map(d => d.volunteer))].length;
      setText('hist-donors-count', uniqueDonors);
      if (items.length === 0) {
        list.innerHTML = `<div class="empty-state"><div class="empty-icon">üì≠</div><div class="empty-text">No ${f} donations yet.</div></div>`;
        return;
      }
      list.innerHTML = [...items].reverse().map(d => {
        const emoji = foodEmojis[d.type] || 'üç±';
        const sColor = d.status === 'live' ? 'var(--lime)' : d.status === 'picked' ? 'var(--amber)' : d.status === 'delivered' ? 'var(--cyan)' : 'var(--muted)';
        const sLabel = d.status.charAt(0).toUpperCase() + d.status.slice(1);
        return `<div style="background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:12px 14px;display:flex;gap:12px;align-items:center">
      <div style="width:40px;height:40px;border-radius:10px;background:${foodColors[d.type] || 'rgba(184,249,40,0.1)'};display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0">${emoji}</div>
      <div style="flex:1;min-width:0">
        <div style="font-weight:600;font-size:.88rem;margin-bottom:2px">${d.type} ‚Äî ${d.qty} kg</div>
        <div style="font-size:.7rem;color:var(--muted)">${d.day} ¬∑ ${d.time}${d.volunteer ? ' ¬∑ from ' + d.volunteer : ''}</div>
        ${d.allergens && d.allergens.length ? `<div style="margin-top:4px;display:flex;gap:4px">${d.allergens.map(a => `<span class="chip chip-blue" style="font-size:.52rem">${a}</span>`).join('')}</div>` : ''}
      </div>
      <div style="text-align:right;flex-shrink:0">
        <div style="font-size:.7rem;color:${sColor};font-family:var(--font-m)">${sLabel}</div>
        <div style="font-size:.62rem;color:var(--muted);font-family:var(--font-m);margin-top:2px">#${d.id}</div>
        <div style="font-size:.7rem;color:var(--lime);font-family:var(--font-h);font-weight:700;margin-top:2px">${d.portions} meals</div>
      </div>
    </div>`;
      }).join('');
    }

    function filterHistory(f, el) {
      document.querySelectorAll('#screen-ngo-history .filter-chip').forEach(c => {
        c.classList.remove('active');
        c.style.background = ''; c.style.color = ''; c.style.borderColor = '';
      });
      if (el) {
        el.classList.add('active');
        el.style.background = 'rgba(6,214,160,.1)';
        el.style.color = 'var(--cyan)';
        el.style.borderColor = 'rgba(6,214,160,.3)';
      }
      renderNgoHistory(f);
    }

    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    //  VOLUNTEER LEADERBOARD
    // ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
    function renderFullLeaderboard() {
      const container = document.getElementById('full-leaderboard');
      if (!container) return;
      const riders = [
        { rank: 1, name: 'Priya S.', xp: 4920, deliveries: 198, badge: 'ü•á', color: '#ffd700' },
        { rank: 2, name: 'Arjun K.', xp: 4210, deliveries: 172, badge: 'ü•à', color: '#c0c0c0' },
        { rank: 3, name: 'Raza M. (You)', xp: STATE.volXP, deliveries: 142, badge: 'ü•â', color: '#cd7f32', isMe: true },
        { rank: 4, name: 'Sneha D.', xp: 3210, deliveries: 131, badge: '4', color: 'var(--muted)' },
        { rank: 5, name: 'Vikram P.', xp: 2890, deliveries: 118, badge: '5', color: 'var(--muted)' },
        { rank: 6, name: 'Meera R.', xp: 2340, deliveries: 95, badge: '6', color: 'var(--muted)' },
        { rank: 7, name: 'Sanjay K.', xp: 1980, deliveries: 81, badge: '7', color: 'var(--muted)' },
      ];
      container.innerHTML = riders.map(r => `
    <div style="display:flex;align-items:center;gap:12px;padding:12px 14px;border-radius:12px;background:${r.isMe ? 'rgba(184,249,40,0.05)' : 'var(--surface)'};border:1px solid ${r.isMe ? 'rgba(184,249,40,0.25)' : 'var(--border)'};margin-bottom:6px;transition:all .2s">
      <div style="width:26px;text-align:center;font-size:${r.rank <= 3 ? '1rem' : '.8rem'};color:${r.color};font-weight:700;flex-shrink:0">${r.badge}</div>
      <div style="width:36px;height:36px;border-radius:10px;background:var(--panel);display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0">üßë</div>
      <div style="flex:1">
        <div style="font-weight:600;font-size:.88rem${r.isMe ? ';color:var(--lime)' : ''}">${r.name}</div>
        <div style="font-size:.68rem;color:var(--muted)">${r.deliveries} deliveries</div>
      </div>
      <div style="font-family:var(--font-h);font-weight:800;font-size:.95rem;color:${r.isMe ? 'var(--lime)' : 'var(--white)'}">${r.xp.toLocaleString()}</div>
    </div>`).join('');
      setText('rank-xp-text', `${STATE.volXP.toLocaleString()} / 5,000 XP ‚Üí Level 9`);
    }
  </script>
</body>

</html>